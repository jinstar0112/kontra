function qFactory(t,e){function n(t,e,r){var i;if(t)if(a(t))for(i in t)"prototype"==i||"length"==i||"name"==i||t.hasOwnProperty&&!t.hasOwnProperty(i)||e.call(r,t[i],i);else if(t.forEach&&t.forEach!==n)t.forEach(e,r);else if(c(t))for(i=0;i<t.length;i++)e.call(r,t[i],i);else for(i in t)t.hasOwnProperty(i)&&e.call(r,t[i],i);return t}function r(t){return t}function i(t){return d(t)}function o(t){var e=u(),r=0,i=c(t)?[]:{};return n(t,function(t,n){r++,h(t).then(function(t){i.hasOwnProperty(n)||(i[n]=t,--r||e.resolve(i))},function(t){i.hasOwnProperty(n)||e.reject(t)},function(t){i.hasOwnProperty(n)||e.notify(t)})}),0===r&&e.resolve(i),e.promise}var s={}.toString,a=function(t){return"function"==typeof t},c=function(t){return"[object Array]"===s.call(t)},u=function(){var n,o,s=[];return o={resolve:function(e){if(s){var r=s;s=void 0,n=h(e),r.length&&t(function(){for(var t,e=0,i=r.length;i>e;e++)t=r[e],n.then(t[0],t[1],t[2])})}},reject:function(t){o.resolve(f(t))},notify:function(e){if(s){var n=s;s.length&&t(function(){for(var t,r=0,i=n.length;i>r;r++)t=n[r],t[2](e)})}},promise:{then:function(t,o,c){var h=u(),d=function(n){try{h.resolve((a(t)?t:r)(n))}catch(i){h.reject(i),e(i)}},f=function(t){try{h.resolve((a(o)?o:i)(t))}catch(n){h.reject(n),e(n)}},l=function(t){try{h.notify((a(c)?c:r)(t))}catch(n){e(n)}};return s?s.push([d,f,l]):n.then(d,f,l),h.promise},"catch":function(t){return this.then(null,t)},"finally":function(t){function e(t,e){var n=u();return e?n.resolve(t):n.reject(t),n.promise}function n(n,i){var o=null;try{o=(t||r)()}catch(s){return e(s,!1)}return o&&a(o.then)?o.then(function(){return e(n,i)},function(t){return e(t,!1)}):e(n,i)}return this.then(function(t){return n(t,!0)},function(t){return n(t,!1)})}}}},h=function(e){return e&&a(e.then)?e:{then:function(n){var r=u();return t(function(){r.resolve(n(e))}),r.promise}}},d=function(t){var e=u();return e.reject(t),e.promise},f=function(n){return{then:function(r,o){var s=u();return t(function(){try{s.resolve((a(o)?o:i)(n))}catch(t){s.reject(t),e(t)}}),s.promise}}},l=function(n,o,s,c){var f,l=u(),p=function(t){try{return(a(o)?o:r)(t)}catch(n){return e(n),d(n)}},m=function(t){try{return(a(s)?s:i)(t)}catch(n){return e(n),d(n)}},v=function(t){try{return(a(c)?c:r)(t)}catch(n){e(n)}};return t(function(){h(n).then(function(t){f||(f=!0,l.resolve(h(t).then(p,m,v)))},function(t){f||(f=!0,l.resolve(m(t)))},function(t){f||l.notify(v(t))})}),l.promise};return{defer:u,reject:d,when:l,all:o}}window.q=qFactory(function(t){setTimeout(function(){t()},0)},function(t){console.error("qLite: "+t.stack)});var kontra=function(t){var e=/(jpeg|jpg|gif|png)$/,n=/(wav|mp3|ogg|aac|m4a)$/;t.images={},t.audios={},t.data={},t.assetPaths={images:"",audios:"",data:""};var r=new Audio;return t.canUse=t.canUse||{},t.canUse.wav="",t.canUse.mp3=r.canPlayType("audio/mpeg;").replace(/^no$/,""),t.canUse.ogg=r.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),t.canUse.aac=r.canPlayType("audio/aac;").replace(/^no$/,""),t.canUse.m4a=(r.canPlayType("audio/x-m4a;")||t.canUse.aac).replace(/^no$/,""),t.getAssetExtension=function(t){return t.substr((~-t.lastIndexOf(".")>>>0)+2)},t.getAssetType=function(t){var r=this.getAssetExtension(t);return r.match(e)?"Image":r.match(n)?"Audio":"Data"},t.getAssetName=function(t){return t.replace(/\.[^/.]+$/,"")},t}(kontra||{}),kontra=function(t,e){return t.loadAssets=function(){var n,r,i=e.defer(),o=[],s=0,a=arguments.length;arguments.length||i.resolve();for(var c,u=0;c=arguments[u];u++)r=Array.isArray(c)?c[0]:c,n=this.getAssetType(r),function(e){o.push(e.promise),t["load"+n](r).then(function(){e.resolve(),i.notify({loaded:++s,total:a})},function(t){e.reject(t)})}(e.defer());return e.all(o).then(function(){i.resolve()},function(t){i.reject(t)}),i.promise},t.loadImage=function(n){var r=e.defer(),i=this.getAssetName(n),o=new Image;return n=this.assetPaths.images+n,o.onload=function(){t.images[i]=t.images[n]=this,r.resolve(this)},o.onerror=function(){r.reject("Unable to load image "+n)},o.src=n,r.promise},t.loadAudio=function(n){var r,i,o,s,a=e.defer();Array.isArray(n)||(n=[n]);for(var c=0;r=n[c];c++)if(this.canUse[this.getAssetExtension(r)]){o=r;break}return o?(i=this.getAssetName(o),s=new Audio,r=this.assetPaths.audios+o,s.addEventListener("canplay",function(){t.audios[i]=t.audios[r]=this,a.resolve(this)}),s.onerror=function(){a.reject("Unable to load audio "+r)},s.src=r,s.preload="auto",s.load()):a.reject("Browser cannot play any of the audio formats provided"),a.promise},t.loadData=function(n){var r=e.defer(),i=new XMLHttpRequest,o=this.getAssetName(n),s=this.assetPaths.data+n;return i.addEventListener("load",function(){if(200!==i.status)return void r.reject(i.responseText);try{var e=JSON.parse(i.responseText);t.data[o]=t.data[s]=e,r.resolve(e)}catch(n){var a=i.responseText;t.data[o]=t.data[s]=a,r.resolve(a)}}),i.open("GET",s,!0),i.send(),r.promise},t}(kontra||{},q),kontra=function(t,e){return t.bundles={},t.createBundle=function(t,e){this.bundles[t]||(this.bundles[t]=e||[])},t.loadBundles=function(){for(var t,n,r=e.defer(),i=[],o=0,s=0,a=0;n=arguments[a];a++)(t=this.bundles[n])?(s+=t.length,i.push(this.loadAssets.apply(this,t))):r.reject("Bundle '"+n+"' has not been created.");return e.all(i).then(function(){r.resolve()},function(t){r.reject(t)},function(){r.notify({loaded:++o,total:s})}),r.promise},t}(kontra||{},q),kontra=function(t,e){return t.loadManifest=function(n){var r,i=e.defer();return t.loadData(n).then(function(e){t.assetPaths.images=e.imagePath||"",t.assetPaths.audios=e.audioPath||"",t.assetPaths.data=e.dataPath||"";for(var n,o=0;n=e.bundles[o];o++)t.createBundle(n.name,n.assets);return e.loadBundles?(r="all"===e.loadBundles?Object.keys(t.bundles||{}):Array.isArray(e.loadBundles)?e.loadBundles:[e.loadBundles],void t.loadBundles.apply(t,r).then(function(){i.resolve()},function(t){i.reject(t)},function(t){i.notify(t)})):void i.resolve()},function(t){i.reject(t)}),i.promise},t}(kontra||{},q),kontra=function(t,e){"use strict";return t.init=function(n){if(n=n||{},t.isString(n.canvas))this.canvas=e.getElementById(n.canvas);else if(t.isCanvas(n.canvas))this.canvas=n.canvas;else if(this.canvas=e.getElementsByTagName("canvas")[0],!this.canvas){var r=new ReferenceError("No canvas element found.");return void t.logError(r,"You must provide a canvas element for the game.")}this.context=this.canvas.getContext("2d"),this.game={width:this.canvas.width,height:this.canvas.height}},t.logError=function(t,e){console.error("Kontra: "+e+"\n	"+t.stack)},t.noop=function(){},t.isArray=Array.isArray,t.isString=function(t){return"string"==typeof t},t.isNumber=function(t){return"number"==typeof t},t.isImage=function(t){return t&&"img"===t.nodeName.toLowerCase()},t.isCanvas=function(t){return t&&"canvas"===t.nodeName.toLowerCase()},t}(kontra||{},document),kontra=function(t,e){"use strict";return t.timestamp=function(){return e.performance&&e.performance.now?function(){return e.performance.now()}:function(){return(new Date).getTime()}}(),t.gameLoop=function(e){var n=Object.create(t.gameLoop._proto);return n.set(e),n},t.gameLoop._proto={set:function(e){if(e=e||{},"function"!=typeof e.update||"function"!=typeof e.render){var n=new ReferenceError("Required functions not found");return void t.logError(n,"You must provide update() and render() functions to create a game loop.")}this.isStopped=!1,this._accumulator=0,this._delta=1e3/(e.fps||60),this.update=e.update,this.render=e.render},frame:function(){var e=this;if(e._rAF=requestAnimationFrame(e.frame.bind(e)),e._now=t.timestamp(),e._dt=e._now-e._last,e._last=e._now,!(e._dt>1e3)){for(e._accumulator+=e._dt;e._accumulator>=e._delta;)e.update(e._delta/1e3),e._accumulator-=e._delta;e.render()}},start:function(){this._last=t.timestamp(),this.isStopped=!1,requestAnimationFrame(this.frame.bind(this))},stop:function(){this.isStopped=!0,cancelAnimationFrame(this._rAF)}},t}(kontra||{},window),kontra=function(t,e){"use strict";function n(t){return"number"==typeof t.which?t.which:t.keyCode}function r(t){var e=[];t=t.trim().replace("++","+plus");for(var n,r=0;n=p[r];r++)-1!==t.indexOf(n)&&(e.push(n),t=t.replace(n,""));return t=t.replace(/\+/g,"").toLowerCase(),f[t]?e.push("shift+"+f[t]):t&&e.push(t),e.join("+")}function i(t){for(var e,r=[],i=0;e=p[i];i++)t[e+"Key"]&&r.push(e);var o=h[n(t)];return-1===r.indexOf(o)&&r.push(o),r.join("+")}function o(t){for(var e,n=i(t),r=0,o=n.split("+");e=o[r];r++)u[e]=!0;c[n]&&(c[n](t,n),t.preventDefault())}function s(t){var e=h[n(t)];u[e]=!1,l[e]&&(u[l[e]]=!1)}function a(){u={}}for(var c={},u={},h={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"leftwindow",92:"rightwindow",93:"select",144:"numlock",145:"scrolllock",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},d=0;26>d;d++)h[65+d]=String.fromCharCode(65+d).toLowerCase();for(d=0;10>d;d++)h[48+d]=""+d;for(d=1;20>d;d++)h[111+d]="f"+d;for(d=0;10>d;d++)h[96+d]="numpad"+d;var f={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\",plus:"="},l={leftwindow:"meta",select:"meta"},p=["meta","ctrl","alt","shift"];return e.addEventListener("keydown",o),e.addEventListener("keyup",s),e.addEventListener("blur",a),t.keys={},t.keys.bind=function(e,n){if("function"!=typeof n){var i=new SyntaxError("Invalid function.");return void t.logError(i,"You must provide a function as the second parameter.")}e=t.isArray(e)?e:[e];for(var o,s=0;o=e[s];s++){var a=r(o);c[a]=n}},t.keys.unbind=function(e){e=t.isArray(e)?e:[e];for(var n,i=0;n=e[i];i++){var o=r(n);c[o]=void 0}},t.keys.pressed=function(t){var e=r(t),n=!0;t=e.split("+");for(var i,o=0;i=t[o];o++)n=n&&!!u[i];return n},t}(kontra||{},window),kontra=function(t){"use strict";return t.pool=function(e){var n=Object.create(t.pool._proto);return n.set(e),n},t.pool._proto={set:function(e){e=e||{};var n,r;if("function"!=typeof e.create)return n=new SyntaxError("Required function not found."),void t.logError(n,"Parameter 'create' must be a function that returns an object.");if(this.create=e.create.bind(this,e.createProperties||{}),r=this.create(),!r||"function"!=typeof r.render||"function"!=typeof r.update||"function"!=typeof r.set||"function"!=typeof r.isAlive)return n=new ReferenceError("Create object required functions not found."),void t.logError(n,"Objects to be pooled must implement render(), update(), set() and isAlive() functions.");if(this.objects=[r],this.size=1,this.maxSize=e.maxSize||1/0,this.lastIndex=0,this.inUse=0,e.fill)for(;this.objects.length<this.maxSize;)this.objects.unshift(this.create())},get:function(t){t=t||{};var e=this;if(e.objects[0].isAlive()){if(e.size===e.maxSize)return;for(var n=0;n<e.size&&e.objects.length<e.maxSize;n++)e.objects.unshift(e.create());e.size=e.objects.length,e.lastIndex=e.size-1}var r=e.objects[0];r.set(t);for(var i=1;i<e.size;i++)e.objects[i-1]=e.objects[i];e.objects[e.lastIndex]=r,e.inUse++},getAliveObjects:function(){return this.objects.slice(this.objects.length-this.inUse)},clear:function(){this.inUse=0,this.size=1,this.lastIndex=0,this.objects.length=0,this.objects.push(this.create({}))},update:function(){for(var t,e=this.lastIndex,n=this.objects.length-this.inUse;e>=n;)if(t=this.objects[e],t.update(),t.isAlive())e--;else{for(var r=e;r>0;r--)this.objects[r]=this.objects[r-1];this.objects[0]=t,this.inUse--,n++}},render:function(){for(var t=this.objects.length-this.inUse,e=this.lastIndex;e>=t;e--)this.objects[e].render()}},t}(kontra||{}),kontra=function(t,e){"use strict";return t.quadtree=function(e){var n=Object.create(t.quadtree._proto);return n.set(e),n},t.quadtree._proto={set:function(e){e=e||{},this.depth=e.depth||0,this.maxDepth=e.maxDepth||3,this.maxObjects=e.maxObjects||25,this.isBranchNode=!1,this.parentNode=e.parentNode,this.bounds=e.bounds||{x:0,y:0,width:t.game.width,height:t.game.height},this.objects=[],this.subnodes=[]},clear:function(){if(this.isBranchNode)for(var t=0;4>t;t++)this.subnodes[t].clear();this.isBranchNode=!1,this.objects.length=0},get:function(t){for(var e,n,r=this,i=[];r.subnodes.length&&this.isBranchNode;){e=this._getIndex(t);for(var o=0,s=e.length;s>o;o++)n=e[o],i.push.apply(i,this.subnodes[n].get(t));return i}return r.objects},add:function(e){var n,r,i=this;if(t.isArray(e))for(n=0;r=e[n];n++)i.add(r);else{if(i.subnodes.length&&i.isBranchNode)return void i._addToSubnode(e);if(i.objects.push(e),i.objects.length>i.maxObjects&&i.depth<i.maxDepth){for(i._split(),n=0;r=i.objects[n];n++)i._addToSubnode(r);i.objects.length=0}}},_addToSubnode:function(t){for(var e=this._getIndex(t),n=0,r=e.length;r>n;n++)this.subnodes[e[n]].add(t)},_getIndex:function(t){var n=[],r=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,o=t.x!==e?t.x:t.position.x,s=t.y!==e?t.y:t.position.y,a=i>s&&s+t.height>=this.bounds.y,c=s+t.height>=i&&s<this.bounds.y+this.bounds.height;return r>o&&o+t.width>=this.bounds.x&&(a&&n.push(0),c&&n.push(2)),o+t.width>=r&&o<this.bounds.x+this.bounds.width&&(a&&n.push(1),c&&n.push(3)),n},_split:function(){if(this.isBranchNode=!0,!this.subnodes.length)for(var e=this.bounds.width/2|0,n=this.bounds.height/2|0,r=this.bounds.x,i=this.bounds.y,o=0;4>o;o++)this.subnodes[o]=t.quadtree({bounds:{x:r+(o%2===1?e:0),y:i+(o>=2?n:0),width:e,height:n},depth:this.depth+1,maxDepth:this.maxDepth,maxObjects:this.maxObjects,parentNode:this})},render:function(){if((this.objects.length||this.isBranchNode||0===this.depth)&&(t.context.strokeStyle="red",t.context.strokeRect(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height),this.subnodes.length))for(var e=0;4>e;e++)this.subnodes[e].render()}},t}(kontra||{}),kontra=function(t,e,n){"use strict";return t.vector=function(e,n){var r=Object.create(t.vector._proto);return r.set(e,n),r},t.vector._proto={set:function(t,e){this.x=t||0,this.y=e||0},add:function(t,e){this.x+=(t.x||0)*(e||1),this.y+=(t.y||0)*(e||1)},clamp:function(t,n,r,i){this.add=function(o,s){var a=this.x+(o.x||0)*(s||1),c=this.y+(o.y||0)*(s||1);this.x=e.min(e.max(a,t),r),this.y=e.min(e.max(c,n),i)}}},t.sprite=function(e){var n=Object.create(t.sprite._proto);return n.position=t.vector(),n.velocity=t.vector(),n.acceleration=t.vector(),n.set(e),n},t.sprite._proto={advanceSprite:function(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.timeToLive--},drawRect:function(){this.context.fillStyle=this.color,this.context.fillRect(this.position.x,this.position.y,this.width,this.height)},drawImage:function(){this.context.drawImage(this.image,this.position.x,this.position.y)},advanceAnimation:function(t){this.advanceSprite(t),this.currentAnimation.update(t)},drawAnimation:function(){this.currentAnimation.render({context:this.context,x:this.position.x,y:this.position.y})},playAnimation:function(t){this.currentAnimation=this.animations[t]},isAlive:function(){return this.timeToLive>0},set:function(e){e=e||{};var n=this;n.position.set(e.x,e.y),n.velocity.set(e.dx,e.dy),n.acceleration.set(e.ddx,e.ddy),n.timeToLive=e.timeToLive||0,n.context=e.context||t.context,t.isImage(e.image)||t.isCanvas(e.image)?(n.image=e.image,n.width=e.image.width,n.height=e.image.height,n.advance=n.advanceSprite,n.draw=n.drawImage):e.animations?(n.animations=e.animations,n.currentAnimation=e.animations[Object.keys(e.animations)[0]],n.width=n.currentAnimation.width,n.height=n.currentAnimation.height,n.advance=n.advanceAnimation,n.draw=n.drawAnimation):(n.color=e.color,n.width=e.width,n.height=e.height,n.advance=n.advanceSprite,n.draw=n.drawRect),e.update&&(n.update=e.update),e.render&&(n.render=e.render);for(var r in e.properties)e.properties.hasOwnProperty(r)&&(n[r]=e.properties[r])},collidesWith:function(t){var e=t.x!==n?t.x:t.position.x,r=t.y!==n?t.y:t.position.y;return this.position.x<e+t.width&&this.position.x+this.width>e&&this.position.y<r+t.height&&this.position.y+this.height>r?!0:!1},update:function(t){this.advance(t)},render:function(){this.draw()}},t}(kontra||{},Math),kontra=function(t,e){"use strict";return t.animation=function(e){var n=Object.create(t.animation._proto);return n.set(e),n},t.animation._proto={set:function(t){t=t||{},this.spriteSheet=t.spriteSheet,this.frames=t.frames,this.frameSpeed=t.frameSpeed,this.width=t.spriteSheet.frame.width,this.height=t.spriteSheet.frame.height,this.currentFrame=0,this._accumulator=0,this.update=this.advance,this.render=this.draw},advance:function(t){for(t=(1>t?1e3*t:t)||1,this._accumulator+=t;this._accumulator>=this.frameSpeed;)this.currentFrame=++this.currentFrame%this.frames.length,this._accumulator-=this.frameSpeed},draw:function(e){e=e||{};var n=e.context||t.context,r=this.frames[this.currentFrame]/this.spriteSheet.framesPerRow|0,i=this.frames[this.currentFrame]%this.spriteSheet.framesPerRow|0;n.drawImage(this.spriteSheet.image,i*this.spriteSheet.frame.width,r*this.spriteSheet.frame.height,this.spriteSheet.frame.width,this.spriteSheet.frame.height,e.x,e.y,this.spriteSheet.frame.width,this.spriteSheet.frame.height)},play:function(){this.update=this.advance,this.render=this.draw},stop:function(){this.update=t.noop,this.render=t.noop},pause:function(){this.update=t.noop}},t.spriteSheet=function(e){var n=Object.create(t.spriteSheet._proto);return n.set(e),n},t.spriteSheet._proto={set:function(e){if(e=e||{},this.animations={},!t.isImage(e.image)&&!t.isCanvas(e.image)){var n=new SyntaxError("Invalid image.");return void t.logError(n,"You must provide an Image for the SpriteSheet.")}this.image=e.image,this.frame={width:e.frameWidth,height:e.frameHeight},this.framesPerRow=e.image.width/e.frameWidth|0,e.animations&&this.createAnimations(e.animations)},createAnimations:function(n){var r;if(!n||0===Object.keys(n).length)return r=new ReferenceError("No animations found."),void t.logError(r,"You must provide at least one named animation to create an Animation.");var i,o,s,a;for(var c in n)if(n.hasOwnProperty(c)){if(i=n[c],o=i.frames,s=i.frameSpeed,a=[],o===e)return r=new ReferenceError("No animation frames found."),void t.logError(r,"Animation "+c+" must provide a frames property.");if(t.isNumber(o))a.push(o);else if(t.isString(o))a=this._parseFrames(o);else if(t.isArray(o))for(var u,h=0;u=o[h];h++)t.isString(u)?a.push.apply(a,this._parseFrames(u)):a.push(u);this.animations[c]=t.animation({spriteSheet:this,frames:a,frameSpeed:s})}},_parseFrames:function(t){var e,n=[],r=t.split("..").map(Number),i=r[0]<r[1]?1:-1;if(1===i)for(e=r[0];e<=r[1];e++)n.push(e);else for(e=r[0];e>=r[1];e--)n.push(e);return n}},t}(kontra||{}),kontra=function(t,e,n,r){"use strict";return t.canUse=t.canUse||{},t.canUse.localStorage="localStorage"in e&&null!==e.localStorage,t.canUse.localStorage?(t.store={},t.store.set=function(t,e){e===r?this.remove(t):n.setItem(t,JSON.stringify(e))},t.store.get=function(t){var e=n.getItem(t);try{e=JSON.parse(e)}catch(r){}return e},t.store.remove=function(t){n.removeItem(t)},t.store.clear=function(){n.clear()},t):t}(kontra||{},window,window.localStorage);
//# sourceMappingURL=kontra.min.js.map