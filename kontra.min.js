!function(t,e){"use strict";function n(){this.manifestUrl="",this.manifest={},this.assets={},this.assetRoot="./",this.bundles={},this.supportedAssets=["jpeg","jpg","gif","png","wav","mp3","ogg","aac","m4a","js","css","json"],this.isiOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;var t=new Audio;this.canPlay={},this.canPlay.wav=t.canPlayType('audio/wav; codecs="1"').replace(/no/,""),this.canPlay.mp3=t.canPlayType("audio/mpeg;").replace(/no/,""),this.canPlay.ogg=t.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""),this.canPlay.aac=t.canPlayType("audio/aac;").replace(/no/,""),this.canPlay.m4a=(t.canPlayType("audio/x-m4a;")||this.canPlay.aac).replace(/no/,"")}function i(t){if(this.bundles[t])throw new Error("Bundle '"+t+"' already created");this.bundles[t]=Object.create(Object.prototype,{status:{value:"created",writable:!0,enumerable:!1,configurable:!1}})}function r(t){var e,n,i=0;for(var r in t)t.hasOwnProperty(r)&&(e=t[r],n=e instanceof Array?"audio":a(e),"audio"!==n||this.isiOS?i++:i++);return i}function o(t){return"[object String]"===h.call(t)}function a(t){return t.match(/\.(jpeg|jpg|gif|png)$/)?"image":t.match(/\.(wav|mp3|ogg|aac|m4a)$/)?"audio":t.match(/\.(js)$/)?"js":t.match(/\.(css)$/)?"css":t.match(/\.(json)$/)?"json":void 0}function s(t){return t.substr((~-t.lastIndexOf(".")>>>0)+2)}function c(t,e){return t.originalMessage=t.message,t.message="AssetLoader: "+e+"\n	"+t.stack,t}function u(t,e){function n(t,e,i){var r;if(t)if(s(t))for(r in t)"prototype"==r||"length"==r||"name"==r||t.hasOwnProperty&&!t.hasOwnProperty(r)||e.call(i,t[r],r);else if(t.forEach&&t.forEach!==n)t.forEach(e,i);else if(c(t))for(r=0;r<t.length;r++)e.call(i,t[r],r);else for(r in t)t.hasOwnProperty(r)&&e.call(i,t[r],r);return t}function i(t){return t}function r(t){return f(t)}function o(t){var e=u(),i=0,r=c(t)?[]:{};return n(t,function(t,n){i++,h(t).then(function(t){r.hasOwnProperty(n)||(r[n]=t,--i||e.resolve(r))},function(t){r.hasOwnProperty(n)||e.reject(t)},function(t){r.hasOwnProperty(n)||e.notify(t)})}),0===i&&e.resolve(r),e.promise}var a={}.toString,s=function(t){return"function"==typeof t},c=function(t){return"[object Array]"===a.call(t)},u=function(){var n,o,a=[];return o={resolve:function(e){if(a){var i=a;a=void 0,n=h(e),i.length&&t(function(){for(var t,e=0,r=i.length;r>e;e++)t=i[e],n.then(t[0],t[1],t[2])})}},reject:function(t){o.resolve(l(t))},notify:function(e){if(a){var n=a;a.length&&t(function(){for(var t,i=0,r=n.length;r>i;i++)t=n[i],t[2](e)})}},promise:{then:function(t,o,c){var h=u(),f=function(n){try{h.resolve((s(t)?t:i)(n))}catch(r){h.reject(r),e(r)}},l=function(t){try{h.resolve((s(o)?o:r)(t))}catch(n){h.reject(n),e(n)}},d=function(t){try{h.notify((s(c)?c:i)(t))}catch(n){e(n)}};return a?a.push([f,l,d]):n.then(f,l,d),h.promise},"catch":function(t){return this.then(null,t)},"finally":function(t){function e(t,e){var n=u();return e?n.resolve(t):n.reject(t),n.promise}function n(n,r){var o=null;try{o=(t||i)()}catch(a){return e(a,!1)}return o&&s(o.then)?o.then(function(){return e(n,r)},function(t){return e(t,!1)}):e(n,r)}return this.then(function(t){return n(t,!0)},function(t){return n(t,!1)})}}}},h=function(e){return e&&s(e.then)?e:{then:function(n){var i=u();return t(function(){i.resolve(n(e))}),i.promise}}},f=function(t){var e=u();return e.reject(t),e.promise},l=function(n){return{then:function(i,o){var a=u();return t(function(){try{a.resolve((s(o)?o:r)(n))}catch(t){a.reject(t),e(t)}}),a.promise}}},d=function(n,o,a,c){var l,d=u(),p=function(t){try{return(s(o)?o:i)(t)}catch(n){return e(n),f(n)}},m=function(t){try{return(s(a)?a:r)(t)}catch(n){return e(n),f(n)}},v=function(t){try{return(s(c)?c:i)(t)}catch(n){e(n)}};return t(function(){h(n).then(function(t){l||(l=!0,d.resolve(h(t).then(p,m,v)))},function(t){l||(l=!0,d.resolve(m(t)))},function(t){l||d.notify(v(t))})}),d.promise};return{defer:u,reject:f,when:d,all:o}}var h={}.toString;n.prototype.loadManifest=function(t){var e,n,i,r,a=this,s=q.defer();return this.manifestUrl!==t?this.loadJSON(t).then(function(c){a.manifest=c,a.manifestUrl=t,a.assetRoot=c.assetRoot||"./";try{for(e=0,n=c.bundles.length;n>e;e++)i=c.bundles[e],a.createBundle(i.name,!0),a.addBundleAsset(i.name,i.assets,!0)}catch(u){s.reject(u)}c.loadBundles?(o(c.loadBundles)?r="all"===c.loadBundles?Object.keys(a.bundles||{}):[c.loadBundles]:c.loadBundles instanceof Array&&(r=c.loadBundles),a.loadBundle(r).then(function(){s.resolve()},function(t){s.reject(t)},function(t){s.notify(t)})):s.resolve()},function(t){t.message=t.message.replace("JSON","manifest"),s.reject(t)}):s.resolve(),s.promise},n.prototype.createBundle=function(t,e){try{if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)i.call(this,t[n]);else i.call(this,t)}catch(o){throw e?c(o,"Unable to create bundle"):o}},n.prototype.loadBundle=function(t){var e,n=this,i=0,a=0,s=[],u=q.defer(),h=[];t instanceof Array?s=t:o(t)&&(s=[t]);for(var f=0,l=s.length;l>f;f++){if(e=this.bundles[s[f]],!e){var d=new ReferenceError("Bundle not created");return u.reject(c(d,"Unable to load bundle '"+t+"'")),u.promise}a+=r.call(this,e),e.status="loading",h.push(this.loadAsset(e))}return function(t,e){q.all(h).then(function(){for(var n=0,i=e.length;i>n;n++)t.bundles[e[n]].status="loaded";u.resolve()},function(t){u.reject(t)},function(){u.notify({loaded:++i,total:a})})}(n,s),u.promise},n.prototype.addBundleAsset=function(t,e,n){if(!this.bundles[t]){var i=new ReferenceError("Bundle not created");throw n?c(i,"Unable to add asset to bundle '"+t+"'"):i}for(var r in e)e.hasOwnProperty(r)&&(this.bundles[t][r]=e[r])},n.prototype.loadAsset=function(t){var e,n,i,u=this,h=0,f=r.call(this,t),l=q.defer(),d=[];for(var p in t)if(t.hasOwnProperty(p))switch(e=t[p],n=e instanceof Array?"audio":a(e),i=q.defer(),n){case"image":!function(t,e,n){var i=new Image;i.status="loading",i.name=t,i.onload=function(){i.status="loaded",u.assets[t]=i,n.resolve(),l.notify({loaded:++h,total:f})},i.onerror=function(){n.reject(new Error("Unable to load Image '"+t+"'"))},i.src=e,d.push(n.promise)}(p,e,i);break;case"audio":o(e)&&(e=[e]);for(var m,v,g=0,y=e.length;y>g;g++){m=e[g];var w=s(m);if(this.canPlay[w]){v=m;break}}v?(this.isiOS&&f--,function(t,e,n){var i=new Audio;i.status="loading",i.name=t,i.addEventListener("canplay",function(){i.status="loaded",u.assets[t]=i,n.resolve(),l.notify({loaded:++h,total:f})}),i.onerror=function(){n.reject(new Error("Unable to load Audio '"+t+"'"))},i.src=e,i.preload="auto",i.load(),u.isiOS?(i.status="loaded",u.assets[t]=i):d.push(n.promise)}(p,v,i)):(i.reject(new Error("Browser cannot play any of the audio types provided for asset '"+p+"'")),d.push(i.promise));break;case"js":this.loadScript(e).then(function(){i.resolve(),l.notify({loaded:++h,total:f})},function(t){i.reject(new Error(t.name+": "+t.message+" '"+p+"' from src '"+e+"'"))}),d.push(i.promise);break;case"css":this.loadCSS(e).then(function(){i.resolve(),l.notify({loaded:++h,total:f})},function(t){i.reject(new Error(t.name+": "+t.message+" '"+p+"' from src '"+e+"'"))}),d.push(i.promise);break;case"json":!function(t,e,n){u.loadJSON(e).then(function(e){u.assets[t]=e,n.resolve(),l.notify({loaded:++h,total:f})},function(i){n.reject(new Error(i.name+": "+i.message+" '"+t+"' from src '"+e+"'"))}),d.push(n.promise)}(p,e,i);break;default:var b=new TypeError("Unsupported asset type");l.reject(c(b,"File type for asset '"+p+"' is not supported. Please use "+this.supportedAssets.join(", ")))}return 0===f?(l.resolve(),l.promise):(q.all(d).then(function(t){l.resolve(t)},function(t){l.reject(t)}),l.promise)},n.prototype.loadScript=function(t){var n=q.defer(),i=e.createElement("script");return i.async=!0,i.onload=function(){n.resolve()},i.onerror=function(){var t=new Error;n.reject(c(t,"Unable to load JavaScript file"))},i.src=t,e.body.appendChild(i),n.promise},n.prototype.loadCSS=function(t){var n=q.defer(),i=new XMLHttpRequest;return i.addEventListener("load",function(){if(200===i.status&&-1!==i.getResponseHeader("content-type").indexOf("text/css")){var r=e.createElement("style");r.innerHTML=i.responseText,r.setAttribute("data-url",t),e.getElementsByTagName("head")[0].appendChild(r),n.resolve()}else{var o=new Error(i.responseText);n.reject(c(o,"Unable to load CSS file"))}}),i.open("GET",t,!0),i.send(),n.promise},n.prototype.loadJSON=function(t){var e=q.defer(),n=new XMLHttpRequest;return n.addEventListener("load",function(){if(200===n.status)try{var t=JSON.parse(n.responseText);e.resolve(t)}catch(i){e.reject(c(i,"Unable to parse JSON file"))}else{var i=new Error(n.responseText);e.reject(c(i,"Unable to load JSON file"))}}),n.open("GET",t,!0),n.send(),e.promise},window.q=u(function(t){setTimeout(function(){t()},0)},function(t){console.error("qLite: "+t.stack)}),t.AssetLoader=n}(window,document);var kontra=function(t,e){return t.init=function(n){if(n=n||{},t.isString(n.canvas))this.canvas=e.getElementById(n.canvas);else if(t.isCanvas(n.canvas))this.canvas=canvas;else if(this.canvas=e.getElementsByTagName("canvas")[0],!this.canvas){var i=new ReferenceError("No canvas element found.");return void t.logError(i,"You must provide a canvas element for the game.")}this.context=this.canvas.getContext("2d"),this.gameWidth=this.canvas.width,this.gameHeight=this.canvas.height},t.logError=function(t,e){t.originalMessage=t.message,t.message="Kontra: "+e+"\n	"+t.stack,console.error(t.message)},t.noop=function(){},t.isArray=Array.isArray,t.isString=function(t){return"string"==typeof t},t.isNumber=function(t){return"number"==typeof t},t.isImage=function(t){return t&&"img"===t.nodeName.toLowerCase()},t.isCanvas=function(t){return t&&"canvas"===t.nodeName.toLowerCase()},t}(kontra||{},document),kontra=function(t){return t.AssetLoader=AssetLoader,t}(kontra||{}),kontra=function(t,e,n){t.GameLoop=function(e){function r(){n.hidden?y.pause():g&&y.start()}if(e=e||{},"function"!=typeof e.update||"function"!=typeof e.draw){var o=new ReferenceError("Required functions not found");return void t.logError(o,"You must provide update() and draw() functions to create a game loop.")}var a,s,c,u=e.fps||60,h=0,f=0,l=1e3/u,d=e.slowFactor||1,p=d*l,m=e.update,v=e.draw,g=!1,y=this;n.addEventListener("visibilitychange",r,!1),this.start=function(){g=!0,h=0,requestAnimationFrame(this.frame)},this.frame=function(){for(c=requestAnimationFrame(y.frame),stats.begin(),a=i(),s=a-(h||a),h=a,f+=s;f>=p;)m(),f-=p;v(),stats.end()},this.stop=function(){g=!1,cancelAnimationFrame(c)},this.pause=function(){cancelAnimationFrame(c)}};var i=function(){function t(){return e.performance.now()}function n(){return(new Date).getTime()}return e.performance&&e.performance.now?t:n}();return t}(kontra||{},window,document),kontra=function(t,e){function n(t){return"number"==typeof t.which?t.which:t.keyCode}function i(t){var e=[];t=t.trim().replace("++","+plus");for(var n,i=0;n=p[i];i++)-1!==t.indexOf(n)&&(e.push(n),t=t.replace(n,""));return t=t.replace(/\+/g,"").toLowerCase(),l[t]?e.push("shift+"+l[t]):t&&e.push(t),e.join("+")}function r(t){for(var e=[],i=0;modifier=p[i];i++)t[modifier+"Key"]&&e.push(modifier);var r=h[n(t)];return-1===e.indexOf(r)&&e.push(r),e.join("+")}function o(t){for(var e,n=r(t),i=0,o=n.split("+");e=o[i];i++)u[e]=!0;c[n]&&(c[n](t,n),t.preventDefault())}function a(t){var e=h[n(t)];u[e]=!1,d[e]&&(u[d[e]]=!1)}function s(){u={}}var c={},u={},h={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"leftwindow",92:"rightwindow",93:"select",144:"numlock",145:"scrolllock",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};for(f=0;26>f;f++)h[65+f]=String.fromCharCode(65+f).toLowerCase();for(var f=0;10>f;f++)h[48+f]=""+f;for(f=1;20>f;f++)h[111+f]="f"+f;for(f=0;10>f;f++)h[96+f]="numpad"+f;var l={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\",plus:"="},d={leftwindow:"meta",select:"meta"},p=["meta","ctrl","alt","shift"];return e.addEventListener("keydown",o),e.addEventListener("keyup",a),e.addEventListener("blur",s),t.bindKey=function(e,n){if("function"!=typeof n){var r=new SyntaxError("Invalid function.");return void t.logError(r,"You must provide a function as the second parameter.")}e=t.isArray(e)?e:[e];for(var o,a=0;o=e[a];a++){var s=i(o);c[s]=n}},t.unbindKey=function(e){e=t.isArray(e)?e:[e];for(var n,r=0;n=e[r];r++){var o=i(n);c[o]=void 0}},t.keyIsPressed=function(t){var e=i(t),n=!0;t=e.split("+");for(var r,o=0;r=t[o];o++)n=n&&!!u[r];return n},t}(kontra||{},window),kontra=function(t){function e(e){e=e||{};var n=new e.Object;if("function"!=typeof n.draw||"function"!=typeof n.update||"function"!=typeof n.set||"function"!=typeof n.isAlive){var i=new ReferenceError("Required function not found.");return void t.logError(i,"Objects to be pooled must implement draw(), update(), set() and isAlive() functions.")}this.size=e.size,this.lastIndex=e.size-1,this.objects=[],this.objects[0]=n;for(var r=1;r<this.size;r++)this.objects[r]=new e.Object}return t.Pool=e,e.prototype.get=function(t){if(this.objects[0].isAlive())return!1;for(var e=this.objects[0],n=1;n<this.size;n++)this.objects[n-1]=this.objects[n];return this.objects[this.lastIndex]=e.set(t),!0},e.prototype.update=function(){for(var t,e=this.lastIndex;t=this.objects[e];){if(!t.isAlive())return;if(t.update(),t.isAlive())e--;else{for(var n=e;n>0;n--)this.objects[n]=this.objects[n-1];this.objects[0]=t}}},e.prototype.draw=function(){for(var t,e=this.lastIndex;t=this.objects[e];e--){if(!t.isAlive())return;t.draw()}},t}(kontra||{}),kontra=function(t){function e(e){if(!t.Vector){var n=new ReferenceError("Vector() not found.");return void t.logError(n,"Kontra.Sprite requires kontra.Vector.")}this.position=new t.Vector,this.velocity=new t.Vector,this.acceleration=new t.Vector,this.timeToLive=0,this.context=t.context,e&&this.set(e)}return t.Sprite=e,e.prototype.advance=function(){this.velocity.add(this.acceleration),this.position.add(this.velocity),this.timeToLive--},e.prototype.render=function(){this.context.save(),this.context.drawImage(this.image,this.position.x,this.position.y),this.context.restore()},e.prototype.isAlive=function(){return this.timeToLive>0},e.prototype.set=function(e){e=e||{};var n=this;return this.position.set(e.x,e.y),this.velocity.set(e.dx,e.dy),this.acceleration.set(e.ddx,e.ddy),this.timeToLive=e.timeToLive||0,this.context=e.context||this.context,t.isString(e.image)?(this.image=new Image,this.image.onload=function(){n.width=this.width,n.height=this.height},this.image.src=e.image):t.isImage(e.image)||t.isCanvas(e.image)?(this.image=e.image,this.width=this.image.width,this.height=this.image.height):this.render=t.noop,this},e.prototype.update=function(){return this.advance(),this},e.prototype.draw=function(){return this.render(),this},t}(kontra||{}),kontra=function(t,e){function n(e){function n(){i.frameWidth=e.frameWidth||i.image.width,i.frameHeight=e.frameHeight||i.image.height,i.framesPerRow=Math.floor(i.image.width/i.frameWidth)}e=e||{};var i=this;if(t.isString(e.image))this.image=new Image,this.image.onload=n,this.image.src=e.image;else{if(!t.isImage(e.image)){var r=new SyntaxError("Invalid image.");return void t.logError(r,"You must provide an Image or path to an image.")}this.image=e.image,n()}}function i(t){var e=[],n=t.split("..");n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10);var i,r=n[0]<n[1]?1:-1;if(1===r)for(i=n[0];i<=n[1];i++)e.push(i);else for(i=n[0];i>=n[1];i--)e.push(i);return e}function r(n,i){this.animationSequence=i.animationSequence,this.frameSpeed=i.frameSpeed;var r,o,a=0,s=0;this.update=function(){s===this.frameSpeed-1&&(a=++a%this.animationSequence.length),s=++s%this.frameSpeed},this.draw=function(t,e){var i=Math.floor(this.animationSequence[a]/n.framesPerRow),r=Math.floor(this.animationSequence[a]%n.framesPerRow);ctx.drawImage(n.image,r*n.frameWidth,i*n.frameHeight,n.frameWidth,n.frameHeight,t,e,n.frameWidth,n.frameHeight)},this.play=function(){r!==e&&(this.update=r),o!==e&&(this.draw=o),r=o=e},this.stop=function(){r===e&&(r=this.update,this.update=t.noop),o===e&&(o=this.draw,this.draw=t.noop)},this.pause=function(){r===e&&(r=this.update,this.update=t.noop)},this.gotoFrame=function(e){t.isNumber(e)&&e>=0&&e<this.animationSequence.length&&(a=e,s=0)}}return t.SpriteSheet=n,n.prototype.createAnimation=function(n){var o;if(!n||0===Object.keys(n).length)return o=new SyntaxError("No animations found."),void t.logError(o,"You must provide at least one named animation to create an Animation.");this.animations={};var a,s;for(var c in n)if(n.hasOwnProperty(c)){if(a=n[c],s=a.frames,a.frameSpeed=a.frameSpeed||1,a.animationSequence=[],s===e)return o=new SyntaxError("No animation frames found."),void t.logError(o,"Animation "+c+" must provide a frames property.");if(t.isNumber(s))a.animationSequence.push(s);else if(t.isString(s))a.animationSequence=i(s);else if(t.isArray(s))for(var u,h=0;u=s[h];h++)if(t.isString(u)){var f=i(u);a.animationSequence.push.apply(a.animationSequence,f)}else a.animationSequence.push(u);this.animations[c]=new r(this,a)}},n.prototype.getAnimation=function(t){return this.animations[t]},t}(kontra||{}),kontra=function(t,e,n,i){return t.canUse=t.canUse||{},t.canUse.localStorage="localStorage"in e&&null!==e.localStorage,t.canUse.localStorage?(t.store={},t.store.set=function(t,e){e===i?this.remove(t):n.setItem(t,JSON.stringify(e))},t.store.get=function(t){var e=n.getItem(t);try{e=JSON.parse(e)}catch(i){}return e},t.store.remove=function(t){n.removeItem(t)},t.store.clear=function(){n.clear()},t):t}(kontra||{},window,window.localStorage),kontra=function(t,e){return t.TileEngine=function(n){function i(t){var e=t.image,n=t.firsTile||s.length;e.tileWidth=e.width/this.tileWidth,e.tileHeight=e.height/this.tileHeight,e.startTile=n,this.images.push(e);for(var i=0,r=e.tileWidth*e.tileHeight;r>i;i++)s[n+i]=e}function r(){for(var t,e,n,i,r,o,c,h=0;c=this.layers[h];h++)for(var f=0,l=c.data.length;l>f;f++)if(t=c.data[f]){e=s[t],n=f%this.width*this.tileWidth,i=(f/this.width|0)*this.tileHeight;var d=t-e.startTile;r=d%e.tileWidth*this.tileWidth,o=(d/e.tileWidth|0)*this.tileHeight,u.drawImage(e,r,o,this.tileWidth,this.tileHeight,n,i,this.tileWidth,this.tileHeight)}a=!0}n=n||{};var o=this,a=!1,s=[e];this.tileIndex=s,this.tileWidth=n.tileWidth||32,this.tileHeight=n.tileHeight||32,this.width=n.width||t.canvas.width/this.tileWidth|0,this.height=n.height||t.canvas.height/this.tileHeight|0;var c=document.createElement("canvas"),u=c.getContext("2d");c.width=this.width*this.tileWidth,c.height=this.height*this.tileHeight,this.context=n.context||t.context,this.layers=[],this.images=[],this.addImage=function(e){if(e=e||{},t.isString(e.image)){var n=new Image;n.onload=function(){i.call(o,{image:this,firstTile:e.firstTile})},n.src=e.image}else(t.isImage(e.image)||t.isCanvas(e.image))&&i({image:e.image,firstTile:e.firstTile})},this.addLayer=function(t){t=t||{},this.layers.push({name:t.name,data:t.data,index:t.index}),this.layers.sort(function(t,e){return t.index-e.index}),r.call(this)},this.draw=function(){this.context.drawImage(c,0,0)}},t}(kontra||{}),kontra=function(t,e){function n(t,e){this.set(t,e)}return t.Vector=n,n.prototype.set=function(t,e){this.x=t||0,this.y=e||0},n.prototype.add=function(t){this.x+=t.x,this.y+=t.y},n.prototype.length=function(){return e.sqrt(this.x*this.x+this.y*this.y)},n.prototype.angle=function(){return e.atan2(this.y,this.x)},n.prototype.fromAngle=function(t,i){return new n(i*e.cos(t),i*e.sin(t))},t}(kontra||{},Math);