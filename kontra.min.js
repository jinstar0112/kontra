!function(e,t){"use strict";function n(){this.manifestUrl="",this.manifest={},this.assets={},this.assetRoot="./",this.bundles={},this.supportedAssets=["jpeg","jpg","gif","png","wav","mp3","ogg","aac","m4a","js","css","json"],this.isiOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;var e=new Audio;this.canPlay={},this.canPlay.wav=e.canPlayType('audio/wav; codecs="1"').replace(/no/,""),this.canPlay.mp3=e.canPlayType("audio/mpeg;").replace(/no/,""),this.canPlay.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""),this.canPlay.aac=e.canPlayType("audio/aac;").replace(/no/,""),this.canPlay.m4a=(e.canPlayType("audio/x-m4a;")||this.canPlay.aac).replace(/no/,"")}function r(e){if(this.bundles[e])throw new Error("Bundle '"+e+"' already created");this.bundles[e]=Object.create(Object.prototype,{status:{value:"created",writable:!0,enumerable:!1,configurable:!1}})}function o(e){var t,n,r=0;for(var o in e)e.hasOwnProperty(o)&&(t=e[o],n=t instanceof Array?"audio":i(t),"audio"!==n||this.isiOS?r++:r++);return r}function a(e){return"[object String]"===f.call(e)}function i(e){return e.match(/\.(jpeg|jpg|gif|png)$/)?"image":e.match(/\.(wav|mp3|ogg|aac|m4a)$/)?"audio":e.match(/\.(js)$/)?"js":e.match(/\.(css)$/)?"css":e.match(/\.(json)$/)?"json":void 0}function s(e){return e.substr((~-e.lastIndexOf(".")>>>0)+2)}function u(e,t){return e.originalMessage=e.message,e.message="AssetLoader: "+t+"\n	"+e.stack,e}function c(e,t){function n(e,t,r){var o;if(e)if(s(e))for(o in e)"prototype"==o||"length"==o||"name"==o||e.hasOwnProperty&&!e.hasOwnProperty(o)||t.call(r,e[o],o);else if(e.forEach&&e.forEach!==n)e.forEach(t,r);else if(u(e))for(o=0;o<e.length;o++)t.call(r,e[o],o);else for(o in e)e.hasOwnProperty(o)&&t.call(r,e[o],o);return e}function r(e){return e}function o(e){return l(e)}function a(e){var t=c(),r=0,o=u(e)?[]:{};return n(e,function(e,n){r++,f(e).then(function(e){o.hasOwnProperty(n)||(o[n]=e,--r||t.resolve(o))},function(e){o.hasOwnProperty(n)||t.reject(e)},function(e){o.hasOwnProperty(n)||t.notify(e)})}),0===r&&t.resolve(o),t.promise}var i={}.toString,s=function(e){return"function"==typeof e},u=function(e){return"[object Array]"===i.call(e)},c=function(){var n,a,i=[];return a={resolve:function(t){if(i){var r=i;i=void 0,n=f(t),r.length&&e(function(){for(var e,t=0,o=r.length;o>t;t++)e=r[t],n.then(e[0],e[1],e[2])})}},reject:function(e){a.resolve(d(e))},notify:function(t){if(i){var n=i;i.length&&e(function(){for(var e,r=0,o=n.length;o>r;r++)e=n[r],e[2](t)})}},promise:{then:function(e,a,u){var f=c(),l=function(n){try{f.resolve((s(e)?e:r)(n))}catch(o){f.reject(o),t(o)}},d=function(e){try{f.resolve((s(a)?a:o)(e))}catch(n){f.reject(n),t(n)}},p=function(e){try{f.notify((s(u)?u:r)(e))}catch(n){t(n)}};return i?i.push([l,d,p]):n.then(l,d,p),f.promise},"catch":function(e){return this.then(null,e)},"finally":function(e){function t(e,t){var n=c();return t?n.resolve(e):n.reject(e),n.promise}function n(n,o){var a=null;try{a=(e||r)()}catch(i){return t(i,!1)}return a&&s(a.then)?a.then(function(){return t(n,o)},function(e){return t(e,!1)}):t(n,o)}return this.then(function(e){return n(e,!0)},function(e){return n(e,!1)})}}}},f=function(t){return t&&s(t.then)?t:{then:function(n){var r=c();return e(function(){r.resolve(n(t))}),r.promise}}},l=function(e){var t=c();return t.reject(e),t.promise},d=function(n){return{then:function(r,a){var i=c();return e(function(){try{i.resolve((s(a)?a:o)(n))}catch(e){i.reject(e),t(e)}}),i.promise}}},p=function(n,a,i,u){var d,p=c(),h=function(e){try{return(s(a)?a:r)(e)}catch(n){return t(n),l(n)}},m=function(e){try{return(s(i)?i:o)(e)}catch(n){return t(n),l(n)}},v=function(e){try{return(s(u)?u:r)(e)}catch(n){t(n)}};return e(function(){f(n).then(function(e){d||(d=!0,p.resolve(f(e).then(h,m,v)))},function(e){d||(d=!0,p.resolve(m(e)))},function(e){d||p.notify(v(e))})}),p.promise};return{defer:c,reject:l,when:p,all:a}}var f={}.toString;n.prototype.loadManifest=function(e){var t,n,r,o,i=this,s=q.defer();return this.manifestUrl!==e?this.loadJSON(e).then(function(u){i.manifest=u,i.manifestUrl=e,i.assetRoot=u.assetRoot||"./";try{for(t=0,n=u.bundles.length;n>t;t++)r=u.bundles[t],i.createBundle(r.name,!0),i.addBundleAsset(r.name,r.assets,!0)}catch(c){s.reject(c)}u.loadBundles?(a(u.loadBundles)?o="all"===u.loadBundles?Object.keys(i.bundles||{}):[u.loadBundles]:u.loadBundles instanceof Array&&(o=u.loadBundles),i.loadBundle(o).then(function(){s.resolve()},function(e){s.reject(e)},function(e){s.notify(e)})):s.resolve()},function(e){e.message=e.message.replace("JSON","manifest"),s.reject(e)}):s.resolve(),s.promise},n.prototype.createBundle=function(e,t){try{if(e instanceof Array)for(var n=0,o=e.length;o>n;n++)r.call(this,e[n]);else r.call(this,e)}catch(a){throw t?u(a,"Unable to create bundle"):a}},n.prototype.loadBundle=function(e){var t,n=this,r=0,i=0,s=[],c=q.defer(),f=[];e instanceof Array?s=e:a(e)&&(s=[e]);for(var l=0,d=s.length;d>l;l++){if(t=this.bundles[s[l]],!t){var p=new ReferenceError("Bundle not created");return c.reject(u(p,"Unable to load bundle '"+e+"'")),c.promise}i+=o.call(this,t),t.status="loading",f.push(this.loadAsset(t))}return function(e,t){q.all(f).then(function(){for(var n=0,r=t.length;r>n;n++)e.bundles[t[n]].status="loaded";c.resolve()},function(e){c.reject(e)},function(){c.notify({loaded:++r,total:i})})}(n,s),c.promise},n.prototype.addBundleAsset=function(e,t,n){if(!this.bundles[e]){var r=new ReferenceError("Bundle not created");throw n?u(r,"Unable to add asset to bundle '"+e+"'"):r}for(var o in t)t.hasOwnProperty(o)&&(this.bundles[e][o]=t[o])},n.prototype.loadAsset=function(e){var t,n,r,c=this,f=0,l=o.call(this,e),d=q.defer(),p=[];for(var h in e)if(e.hasOwnProperty(h))switch(t=e[h],n=t instanceof Array?"audio":i(t),r=q.defer(),n){case"image":!function(e,t,n){var r=new Image;r.status="loading",r.name=e,r.onload=function(){r.status="loaded",c.assets[e]=r,n.resolve(),d.notify({loaded:++f,total:l})},r.onerror=function(){n.reject(new Error("Unable to load Image '"+e+"'"))},r.src=t,p.push(n.promise)}(h,t,r);break;case"audio":a(t)&&(t=[t]);for(var m,v,g=0,y=t.length;y>g;g++){m=t[g];var w=s(m);if(this.canPlay[w]){v=m;break}}v?(this.isiOS&&l--,function(e,t,n){var r=new Audio;r.status="loading",r.name=e,r.addEventListener("canplay",function(){r.status="loaded",c.assets[e]=r,n.resolve(),d.notify({loaded:++f,total:l})}),r.onerror=function(){n.reject(new Error("Unable to load Audio '"+e+"'"))},r.src=t,r.preload="auto",r.load(),c.isiOS?(r.status="loaded",c.assets[e]=r):p.push(n.promise)}(h,v,r)):(r.reject(new Error("Browser cannot play any of the audio types provided for asset '"+h+"'")),p.push(r.promise));break;case"js":this.loadScript(t).then(function(){r.resolve(),d.notify({loaded:++f,total:l})},function(e){r.reject(new Error(e.name+": "+e.message+" '"+h+"' from src '"+t+"'"))}),p.push(r.promise);break;case"css":this.loadCSS(t).then(function(){r.resolve(),d.notify({loaded:++f,total:l})},function(e){r.reject(new Error(e.name+": "+e.message+" '"+h+"' from src '"+t+"'"))}),p.push(r.promise);break;case"json":!function(e,t,n){c.loadJSON(t).then(function(t){c.assets[e]=t,n.resolve(),d.notify({loaded:++f,total:l})},function(r){n.reject(new Error(r.name+": "+r.message+" '"+e+"' from src '"+t+"'"))}),p.push(n.promise)}(h,t,r);break;default:var S=new TypeError("Unsupported asset type");d.reject(u(S,"File type for asset '"+h+"' is not supported. Please use "+this.supportedAssets.join(", ")))}return 0===l?(d.resolve(),d.promise):(q.all(p).then(function(e){d.resolve(e)},function(e){d.reject(e)}),d.promise)},n.prototype.loadScript=function(e){var n=q.defer(),r=t.createElement("script");return r.async=!0,r.onload=function(){n.resolve()},r.onerror=function(){var e=new Error;n.reject(u(e,"Unable to load JavaScript file"))},r.src=e,t.body.appendChild(r),n.promise},n.prototype.loadCSS=function(e){var n=q.defer(),r=new XMLHttpRequest;return r.addEventListener("load",function(){if(200===r.status&&-1!==r.getResponseHeader("content-type").indexOf("text/css")){var o=t.createElement("style");o.innerHTML=r.responseText,o.setAttribute("data-url",e),t.getElementsByTagName("head")[0].appendChild(o),n.resolve()}else{var a=new Error(r.responseText);n.reject(u(a,"Unable to load CSS file"))}}),r.open("GET",e,!0),r.send(),n.promise},n.prototype.loadJSON=function(e){var t=q.defer(),n=new XMLHttpRequest;return n.addEventListener("load",function(){if(200===n.status)try{var e=JSON.parse(n.responseText);t.resolve(e)}catch(r){t.reject(u(r,"Unable to parse JSON file"))}else{var r=new Error(n.responseText);t.reject(u(r,"Unable to load JSON file"))}}),n.open("GET",e,!0),n.send(),t.promise},window.q=c(function(e){setTimeout(function(){e()},0)},function(e){console.error("qLite: "+e.stack)}),e.AssetLoader=n}(window,document);var kontra={},kontra=function(e){return e.log={},e.log.error=function(e,t){e.originalMessage=e.message,e.message="Kontra: "+t+"\n	"+e.stack,console.error(e.message)},e.noop=function(){},e.isArray=Array.isArray,e.isString=function(e){return"string"==typeof e},e.isNumber=function(e){return"number"==typeof e},e}(kontra||{},window,document),kontra=function(e){return e.assets=new AssetLoader,e}(kontra||{},window,document),kontra=function(e,t,n){e.GameLoop=function(t){function o(){n.hidden?g.stop():g.start()}if(t=t||{},"function"!=typeof t.update||"function"!=typeof t.draw){var a=new ReferenceError("Required functions not found");return void e.log.error(a,"You must provide update() and draw() functions to create a game loop.")}var i,s,u,c=t.fps||60,f=0,l=0,d=1e3/c,p=t.slowFactor||1,h=p*d,m=t.update,v=t.draw,g=this;n.addEventListener("visibilitychange",o,!1),this.start=function(){f=0,requestAnimationFrame(this.frame)},this.frame=function(){for(u=requestAnimationFrame(g.frame),i=r(),s=i-(f||i),f=i,l+=s;l>=h;)m(),l-=h;v()},this.stop=function(){cancelAnimationFrame(u)}};var r=function(){function e(){return t.performance.now()}function n(){return(new Date).getTime()}return t.performance&&t.performance.now?e:n}();return e}(kontra||{},window,document),kontra=function(e,t){function n(e){return"number"==typeof e.which?e.which:e.keyCode}function r(e){var t=[];e=e.trim().replace("++","+plus");for(var n,r=0;n=h[r];r++)-1!==e.indexOf(n)&&(t.push(n),e=e.replace(n,""));return e=e.replace(/\+/g,"").toLowerCase(),d[e]?t.push("shift+"+d[e]):e&&t.push(e),t.join("+")}function o(e){for(var t=[],r=0;modifier=h[r];r++)e[modifier+"Key"]&&t.push(modifier);var o=f[n(e)];return-1===t.indexOf(o)&&t.push(o),t.join("+")}function a(e){for(var t,n=o(e),r=0,a=n.split("+");t=a[r];r++)c[t]=!0;u[n]&&(u[n](e,n),e.preventDefault())}function i(e){var t=f[n(e)];c[t]=!1,p[t]&&(c[p[t]]=!1)}function s(){c={}}var u={},c={},f={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"leftwindow",92:"rightwindow",93:"select",144:"numlock",145:"scrolllock",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};for(l=0;26>l;l++)f[65+l]=String.fromCharCode(65+l).toLowerCase();for(var l=0;10>l;l++)f[48+l]=""+l;for(l=1;20>l;l++)f[111+l]="f"+l;for(l=0;10>l;l++)f[96+l]="numpad"+l;var d={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\",plus:"="},p={leftwindow:"meta",select:"meta"},h=["meta","ctrl","alt","shift"];return t.addEventListener("keydown",a),t.addEventListener("keyup",i),t.addEventListener("blur",s),e.bindKey=function(t,n){if("function"!=typeof n){var o=new SyntaxError("Invalid function.");return void e.log.error(o,"You must provide a function as the second parameter.")}t=e.isArray(t)?t:[t];for(var a,i=0;a=t[i];i++){var s=r(a);u[s]=n}},e.unbindKey=function(t){t=e.isArray(t)?t:[t];for(var n,o=0;n=t[o];o++){var a=r(n);u[a]=void 0}},e.keyIsPressed=function(e){var t=r(e),n=!0;e=t.split("+");for(var o,a=0;o=e[a];a++)n=n&&!!c[o];return n},e}(kontra||{},window,document),kontra=function(e){function t(e){var t=[],n=e.split("..");n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10);var r,o=n[0]<n[1]?1:-1;if(1===o)for(r=n[0];r<=n[1];r++)t.push(r);else for(r=n[0];r>=n[1];r--)t.push(r);return t}function n(t,n){this.animationSequence=n.animationSequence,this.frameSpeed=n.frameSpeed;var r,o,a=0,i=0;this.update=function(){i===this.frameSpeed-1&&(a=++a%this.animationSequence.length),i=++i%this.frameSpeed},this.draw=function(e,n){var r=Math.floor(this.animationSequence[a]/t.framesPerRow),o=Math.floor(this.animationSequence[a]%t.framesPerRow);ctx.drawImage(t.image,o*t.frameWidth,r*t.frameHeight,t.frameWidth,t.frameHeight,e,n,t.frameWidth,t.frameHeight)},this.play=function(){this.update===e.noop&&(this.update=r),this.draw===e.noop&&(this.draw=o),r=o=void 0},this.stop=function(){this.update!==e.noop&&(r=this.update,this.update=e.noop),this.draw!==e.noop&&(o=this.draw,this.draw=e.noop)},this.pause=function(){this.update!==e.noop&&(r=this.update,this.update=e.noop)},this.gotoFrame=function(t){e.isNumber(t)&&t>=0&&t<this.animationSequence.length&&(a=t,i=0)}}return e.SpriteSheet=function(t){function n(){r.frameWidth=t.frameWidth||r.image.width,r.frameHeight=t.frameHeight||r.image.height,r.framesPerRow=Math.floor(r.image.width/r.frameWidth)}t=t||{};var r=this;if(e.isString(t.image))this.image=new Image,this.image.onload=n,this.image.src=t.image;else{if(!(t.image instanceof Image)){var o=new SyntaxError("Invalid image.");return void e.log.error(o,"You must provide an Image or path to an image.")}this.image=t.image,n()}},e.SpriteSheet.prototype.createAnimation=function(r){var o;if(!r||0===Object.keys(r).length)return o=new SyntaxError("No animations found."),void e.log.error(o,"You must provide at least one named animation to create an Animation.");this.animations={};var a,i;for(var s in r)if(r.hasOwnProperty(s)){if(a=r[s],i=a.frames,a.frameSpeed=a.frameSpeed||1,a.animationSequence=[],void 0===i)return o=new SyntaxError("No animation frames found."),void e.log.error(o,"Animation "+s+" must provide a frames property.");if(e.isNumber(i))a.animationSequence.push(i);else if(e.isString(i))a.animationSequence=t(i);else if(e.isArray(i))for(var u,c=0;u=i[c];c++)if(e.isString(u)){var f=t(u);a.animationSequence.push.apply(a.animationSequence,f)}else a.animationSequence.push(u);this.animations[s]=new n(this,a)}},e.SpriteSheet.prototype.getAnimation=function(e){return this.animations[e]},e}(kontra||{},window,document),kontra=function(e,t,n,r){return e.canUse=e.canUse||{},e.canUse.localStorage="localStorage"in t&&null!==t.localStorage,e.canUse.localStorage?(e.store={},e.store.set=function(e,t){void 0===t?this.remove(e):r.setItem(e,JSON.stringify(t))},e.store.get=function(e){var t=r.getItem(e);try{t=JSON.parse(t)}catch(n){}return t},e.store.remove=function(e){r.removeItem(e)},e.store.clear=function(){r.clear()},e):e}(kontra||{},window,document,window.localStorage);