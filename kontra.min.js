!function(e,t){"use strict";function n(){this.manifestUrl="",this.manifest={},this.assets={},this.assetRoot="./",this.bundles={},this.supportedAssets=["jpeg","jpg","gif","png","wav","mp3","ogg","aac","m4a","js","css","json"],this.isiOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;var e=new Audio;this.canPlay={},this.canPlay.wav=e.canPlayType('audio/wav; codecs="1"').replace(/no/,""),this.canPlay.mp3=e.canPlayType("audio/mpeg;").replace(/no/,""),this.canPlay.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""),this.canPlay.aac=e.canPlayType("audio/aac;").replace(/no/,""),this.canPlay.m4a=(e.canPlayType("audio/x-m4a;")||this.canPlay.aac).replace(/no/,"")}function r(e){if(this.bundles[e])throw new Error("Bundle '"+e+"' already created");this.bundles[e]=Object.create(Object.prototype,{status:{value:"created",writable:!0,enumerable:!1,configurable:!1}})}function o(e){var t,n,r=0;for(var o in e)e.hasOwnProperty(o)&&(t=e[o],n=t instanceof Array?"audio":a(t),"audio"!==n||this.isiOS?r++:r++);return r}function i(e){return"[object String]"===f.call(e)}function a(e){return e.match(/\.(jpeg|jpg|gif|png)$/)?"image":e.match(/\.(wav|mp3|ogg|aac|m4a)$/)?"audio":e.match(/\.(js)$/)?"js":e.match(/\.(css)$/)?"css":e.match(/\.(json)$/)?"json":void 0}function s(e){return e.substr((~-e.lastIndexOf(".")>>>0)+2)}function c(e,t){return e.originalMessage=e.message,e.message="AssetLoader: "+t+"\n	"+e.stack,e}function u(e,t){function n(e,t,r){var o;if(e)if(s(e))for(o in e)"prototype"==o||"length"==o||"name"==o||e.hasOwnProperty&&!e.hasOwnProperty(o)||t.call(r,e[o],o);else if(e.forEach&&e.forEach!==n)e.forEach(t,r);else if(c(e))for(o=0;o<e.length;o++)t.call(r,e[o],o);else for(o in e)e.hasOwnProperty(o)&&t.call(r,e[o],o);return e}function r(e){return e}function o(e){return l(e)}function i(e){var t=u(),r=0,o=c(e)?[]:{};return n(e,function(e,n){r++,f(e).then(function(e){o.hasOwnProperty(n)||(o[n]=e,--r||t.resolve(o))},function(e){o.hasOwnProperty(n)||t.reject(e)},function(e){o.hasOwnProperty(n)||t.notify(e)})}),0===r&&t.resolve(o),t.promise}var a={}.toString,s=function(e){return"function"==typeof e},c=function(e){return"[object Array]"===a.call(e)},u=function(){var n,i,a=[];return i={resolve:function(t){if(a){var r=a;a=void 0,n=f(t),r.length&&e(function(){for(var e,t=0,o=r.length;o>t;t++)e=r[t],n.then(e[0],e[1],e[2])})}},reject:function(e){i.resolve(h(e))},notify:function(t){if(a){var n=a;a.length&&e(function(){for(var e,r=0,o=n.length;o>r;r++)e=n[r],e[2](t)})}},promise:{then:function(e,i,c){var f=u(),l=function(n){try{f.resolve((s(e)?e:r)(n))}catch(o){f.reject(o),t(o)}},h=function(e){try{f.resolve((s(i)?i:o)(e))}catch(n){f.reject(n),t(n)}},d=function(e){try{f.notify((s(c)?c:r)(e))}catch(n){t(n)}};return a?a.push([l,h,d]):n.then(l,h,d),f.promise},"catch":function(e){return this.then(null,e)},"finally":function(e){function t(e,t){var n=u();return t?n.resolve(e):n.reject(e),n.promise}function n(n,o){var i=null;try{i=(e||r)()}catch(a){return t(a,!1)}return i&&s(i.then)?i.then(function(){return t(n,o)},function(e){return t(e,!1)}):t(n,o)}return this.then(function(e){return n(e,!0)},function(e){return n(e,!1)})}}}},f=function(t){return t&&s(t.then)?t:{then:function(n){var r=u();return e(function(){r.resolve(n(t))}),r.promise}}},l=function(e){var t=u();return t.reject(e),t.promise},h=function(n){return{then:function(r,i){var a=u();return e(function(){try{a.resolve((s(i)?i:o)(n))}catch(e){a.reject(e),t(e)}}),a.promise}}},d=function(n,i,a,c){var h,d=u(),p=function(e){try{return(s(i)?i:r)(e)}catch(n){return t(n),l(n)}},m=function(e){try{return(s(a)?a:o)(e)}catch(n){return t(n),l(n)}},v=function(e){try{return(s(c)?c:r)(e)}catch(n){t(n)}};return e(function(){f(n).then(function(e){h||(h=!0,d.resolve(f(e).then(p,m,v)))},function(e){h||(h=!0,d.resolve(m(e)))},function(e){h||d.notify(v(e))})}),d.promise};return{defer:u,reject:l,when:d,all:i}}var f={}.toString;n.prototype.loadManifest=function(e){var t,n,r,o,a=this,s=q.defer();return this.manifestUrl!==e?this.loadJSON(e).then(function(c){a.manifest=c,a.manifestUrl=e,a.assetRoot=c.assetRoot||"./";try{for(t=0,n=c.bundles.length;n>t;t++)r=c.bundles[t],a.createBundle(r.name,!0),a.addBundleAsset(r.name,r.assets,!0)}catch(u){s.reject(u)}c.loadBundles?(i(c.loadBundles)?o="all"===c.loadBundles?Object.keys(a.bundles||{}):[c.loadBundles]:c.loadBundles instanceof Array&&(o=c.loadBundles),a.loadBundle(o).then(function(){s.resolve()},function(e){s.reject(e)},function(e){s.notify(e)})):s.resolve()},function(e){e.message=e.message.replace("JSON","manifest"),s.reject(e)}):s.resolve(),s.promise},n.prototype.createBundle=function(e,t){try{if(e instanceof Array)for(var n=0,o=e.length;o>n;n++)r.call(this,e[n]);else r.call(this,e)}catch(i){throw t?c(i,"Unable to create bundle"):i}},n.prototype.loadBundle=function(e){var t,n=this,r=0,a=0,s=[],u=q.defer(),f=[];e instanceof Array?s=e:i(e)&&(s=[e]);for(var l=0,h=s.length;h>l;l++){if(t=this.bundles[s[l]],!t){var d=new ReferenceError("Bundle not created");return u.reject(c(d,"Unable to load bundle '"+e+"'")),u.promise}a+=o.call(this,t),t.status="loading",f.push(this.loadAsset(t))}return function(e,t){q.all(f).then(function(){for(var n=0,r=t.length;r>n;n++)e.bundles[t[n]].status="loaded";u.resolve()},function(e){u.reject(e)},function(){u.notify({loaded:++r,total:a})})}(n,s),u.promise},n.prototype.addBundleAsset=function(e,t,n){if(!this.bundles[e]){var r=new ReferenceError("Bundle not created");throw n?c(r,"Unable to add asset to bundle '"+e+"'"):r}for(var o in t)t.hasOwnProperty(o)&&(this.bundles[e][o]=t[o])},n.prototype.loadAsset=function(e){var t,n,r,u=this,f=0,l=o.call(this,e),h=q.defer(),d=[];for(var p in e)if(e.hasOwnProperty(p))switch(t=e[p],n=t instanceof Array?"audio":a(t),r=q.defer(),n){case"image":!function(e,t,n){var r=new Image;r.status="loading",r.name=e,r.onload=function(){r.status="loaded",u.assets[e]=r,n.resolve(),h.notify({loaded:++f,total:l})},r.onerror=function(){n.reject(new Error("Unable to load Image '"+e+"'"))},r.src=t,d.push(n.promise)}(p,t,r);break;case"audio":i(t)&&(t=[t]);for(var m,v,g=0,y=t.length;y>g;g++){m=t[g];var w=s(m);if(this.canPlay[w]){v=m;break}}v?(this.isiOS&&l--,function(e,t,n){var r=new Audio;r.status="loading",r.name=e,r.addEventListener("canplay",function(){r.status="loaded",u.assets[e]=r,n.resolve(),h.notify({loaded:++f,total:l})}),r.onerror=function(){n.reject(new Error("Unable to load Audio '"+e+"'"))},r.src=t,r.preload="auto",r.load(),u.isiOS?(r.status="loaded",u.assets[e]=r):d.push(n.promise)}(p,v,r)):(r.reject(new Error("Browser cannot play any of the audio types provided for asset '"+p+"'")),d.push(r.promise));break;case"js":this.loadScript(t).then(function(){r.resolve(),h.notify({loaded:++f,total:l})},function(e){r.reject(new Error(e.name+": "+e.message+" '"+p+"' from src '"+t+"'"))}),d.push(r.promise);break;case"css":this.loadCSS(t).then(function(){r.resolve(),h.notify({loaded:++f,total:l})},function(e){r.reject(new Error(e.name+": "+e.message+" '"+p+"' from src '"+t+"'"))}),d.push(r.promise);break;case"json":!function(e,t,n){u.loadJSON(t).then(function(t){u.assets[e]=t,n.resolve(),h.notify({loaded:++f,total:l})},function(r){n.reject(new Error(r.name+": "+r.message+" '"+e+"' from src '"+t+"'"))}),d.push(n.promise)}(p,t,r);break;default:var b=new TypeError("Unsupported asset type");h.reject(c(b,"File type for asset '"+p+"' is not supported. Please use "+this.supportedAssets.join(", ")))}return 0===l?(h.resolve(),h.promise):(q.all(d).then(function(e){h.resolve(e)},function(e){h.reject(e)}),h.promise)},n.prototype.loadScript=function(e){var n=q.defer(),r=t.createElement("script");return r.async=!0,r.onload=function(){n.resolve()},r.onerror=function(){var e=new Error;n.reject(c(e,"Unable to load JavaScript file"))},r.src=e,t.body.appendChild(r),n.promise},n.prototype.loadCSS=function(e){var n=q.defer(),r=new XMLHttpRequest;return r.addEventListener("load",function(){if(200===r.status&&-1!==r.getResponseHeader("content-type").indexOf("text/css")){var o=t.createElement("style");o.innerHTML=r.responseText,o.setAttribute("data-url",e),t.getElementsByTagName("head")[0].appendChild(o),n.resolve()}else{var i=new Error(r.responseText);n.reject(c(i,"Unable to load CSS file"))}}),r.open("GET",e,!0),r.send(),n.promise},n.prototype.loadJSON=function(e){var t=q.defer(),n=new XMLHttpRequest;return n.addEventListener("load",function(){if(200===n.status)try{var e=JSON.parse(n.responseText);t.resolve(e)}catch(r){t.reject(c(r,"Unable to parse JSON file"))}else{var r=new Error(n.responseText);t.reject(c(r,"Unable to load JSON file"))}}),n.open("GET",e,!0),n.send(),t.promise},window.q=u(function(e){setTimeout(function(){e()},0)},function(e){console.error("qLite: "+e.stack)}),e.AssetLoader=n}(window,document);var kontra=function(e,t){return e.init=function(n){if(n=n||{},e.isString(n.canvas))this.canvas=t.getElementById(n.canvas);else if(e.isCanvas(n.canvas))this.canvas=canvas;else if(this.canvas=t.getElementsByTagName("canvas")[0],!this.canvas){var r=new ReferenceError("No canvas element found.");return void e.log.error(r,"You must provide a canvas element for the game.")}this.context=this.canvas.getContext("2d"),this.gameWidth=this.canvas.width,this.gameHeight=this.canvas.height},e.log={},e.log.error=function(e,t){e.originalMessage=e.message,e.message="Kontra: "+t+"\n	"+e.stack,console.error(e.message)},e.noop=function(){},e.isArray=Array.isArray,e.isString=function(e){return"string"==typeof e},e.isNumber=function(e){return"number"==typeof e},e.isImage=function(e){return e&&"img"===e.nodeName.toLowerCase()},e.isCanvas=function(e){return e&&"canvas"===e.nodeName.toLowerCase()},e}(kontra||{},document),kontra=function(e){return e.AssetLoader=AssetLoader,e}(kontra||{}),kontra=function(e,t,n){e.GameLoop=function(t){function o(){n.hidden?g.stop():g.start()}if(t=t||{},"function"!=typeof t.update||"function"!=typeof t.draw){var i=new ReferenceError("Required functions not found");return void e.log.error(i,"You must provide update() and draw() functions to create a game loop.")}var a,s,c,u=t.fps||60,f=0,l=0,h=1e3/u,d=t.slowFactor||1,p=d*h,m=t.update,v=t.draw,g=this;n.addEventListener("visibilitychange",o,!1),this.start=function(){f=0,requestAnimationFrame(this.frame)},this.frame=function(){for(c=requestAnimationFrame(g.frame),a=r(),s=a-(f||a),f=a,l+=s;l>=p;)m(),l-=p;v()},this.stop=function(){cancelAnimationFrame(c)}};var r=function(){function e(){return t.performance.now()}function n(){return(new Date).getTime()}return t.performance&&t.performance.now?e:n}();return e}(kontra||{},window,document),kontra=function(e,t){function n(e){return"number"==typeof e.which?e.which:e.keyCode}function r(e){var t=[];e=e.trim().replace("++","+plus");for(var n,r=0;n=p[r];r++)-1!==e.indexOf(n)&&(t.push(n),e=e.replace(n,""));return e=e.replace(/\+/g,"").toLowerCase(),h[e]?t.push("shift+"+h[e]):e&&t.push(e),t.join("+")}function o(e){for(var t=[],r=0;modifier=p[r];r++)e[modifier+"Key"]&&t.push(modifier);var o=f[n(e)];return-1===t.indexOf(o)&&t.push(o),t.join("+")}function i(e){for(var t,n=o(e),r=0,i=n.split("+");t=i[r];r++)u[t]=!0;c[n]&&(c[n](e,n),e.preventDefault())}function a(e){var t=f[n(e)];u[t]=!1,d[t]&&(u[d[t]]=!1)}function s(){u={}}var c={},u={},f={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"leftwindow",92:"rightwindow",93:"select",144:"numlock",145:"scrolllock",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};for(l=0;26>l;l++)f[65+l]=String.fromCharCode(65+l).toLowerCase();for(var l=0;10>l;l++)f[48+l]=""+l;for(l=1;20>l;l++)f[111+l]="f"+l;for(l=0;10>l;l++)f[96+l]="numpad"+l;var h={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\",plus:"="},d={leftwindow:"meta",select:"meta"},p=["meta","ctrl","alt","shift"];return t.addEventListener("keydown",i),t.addEventListener("keyup",a),t.addEventListener("blur",s),e.bindKey=function(t,n){if("function"!=typeof n){var o=new SyntaxError("Invalid function.");return void e.log.error(o,"You must provide a function as the second parameter.")}t=e.isArray(t)?t:[t];for(var i,a=0;i=t[a];a++){var s=r(i);c[s]=n}},e.unbindKey=function(t){t=e.isArray(t)?t:[t];for(var n,o=0;n=t[o];o++){var i=r(n);c[i]=void 0}},e.keyIsPressed=function(e){var t=r(e),n=!0;e=t.split("+");for(var o,i=0;o=e[i];i++)n=n&&!!u[o];return n},e}(kontra||{},window),kontra=function(e){function t(t){t=t||{};var n=new t.Object;if("function"!=typeof n.draw||"function"!=typeof n.update||"function"!=typeof n.set||"function"!=typeof n.isAlive){var r=new ReferenceError("Required function not found.");return void e.log.error(r,"Objects to be pooled must implement draw(), update(), set() and isAlive() functions.")}this.size=t.size,this.lastIndex=t.size-1,this.objects=[],this.objects[0]=n;for(var o=1;o<this.size;o++)this.objects[o]=new t.Object}return e.Pool=t,t.prototype.get=function(e){if(this.objects[0].isAlive())return!1;for(var t=this.objects[0],n=1;n<this.size;n++)this.objects[n-1]=this.objects[n];return this.objects[this.lastIndex]=t.set(e),!0},t.prototype.update=function(){for(var e,t=this.lastIndex;e=this.objects[t];){if(!e.isAlive())return;if(e.update(),e.isAlive())t--;else{for(var n=t;n>0;n--)this.objects[n]=this.objects[n-1];this.objects[0]=e}}},t.prototype.draw=function(){for(var e,t=this.lastIndex;e=this.objects[t];t--){if(!e.isAlive())return;e.draw()}},e}(kontra||{}),kontra=function(e){function t(){if(!e.Vector){var t=new ReferenceError("Vector() not found.");return void e.log.error(t,"Kontra.Sprite requires kontra.Vector.")}this.position=new e.Vector,this.velocity=new e.Vector,this.acceleration=new e.Vector,this.timeToLive=0,this.context=e.context}return e.Sprite=t,t.prototype.advance=function(){this.velocity.add(this.acceleration),this.position.add(this.velocity),this.timeToLive--},t.prototype.render=function(){this.context.save(),this.context.drawImage(this.image,this.position.x,this.position.y),this.context.restore()},t.prototype.isAlive=function(){return this.timeToLive>0},t.prototype.set=function(t){t=t||{};var n=this;return this.position.set(t.x,t.y),this.velocity.set(t.dx,t.dy),this.acceleration.set(t.ddx,t.ddy),this.timeToLive=t.timeToLive||0,this.context=t.context||this.context,e.isString(t.image)?(this.image=new Image,this.image.onload=function(){n.width=this.width,n.height=this.height},this.image.src=t.image):e.isImage(t.image)||e.isCanvas(t.image)?(this.image=t.image,this.width=this.image.width,this.height=this.image.height):this.render=e.noop,this},t.prototype.update=function(){return this.advance(),this},t.prototype.draw=function(){return this.render(),this},e}(kontra||{}),kontra=function(e,t){function n(t){function n(){r.frameWidth=t.frameWidth||r.image.width,r.frameHeight=t.frameHeight||r.image.height,r.framesPerRow=Math.floor(r.image.width/r.frameWidth)}t=t||{};var r=this;if(e.isString(t.image))this.image=new Image,this.image.onload=n,this.image.src=t.image;else{if(!e.isImage(t.image)){var o=new SyntaxError("Invalid image.");return void e.log.error(o,"You must provide an Image or path to an image.")}this.image=t.image,n()}}function r(e){var t=[],n=e.split("..");n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10);var r,o=n[0]<n[1]?1:-1;if(1===o)for(r=n[0];r<=n[1];r++)t.push(r);else for(r=n[0];r>=n[1];r--)t.push(r);return t}function o(n,r){this.animationSequence=r.animationSequence,this.frameSpeed=r.frameSpeed;var o,i,a=0,s=0;this.update=function(){s===this.frameSpeed-1&&(a=++a%this.animationSequence.length),s=++s%this.frameSpeed},this.draw=function(e,t){var r=Math.floor(this.animationSequence[a]/n.framesPerRow),o=Math.floor(this.animationSequence[a]%n.framesPerRow);ctx.drawImage(n.image,o*n.frameWidth,r*n.frameHeight,n.frameWidth,n.frameHeight,e,t,n.frameWidth,n.frameHeight)},this.play=function(){o!==t&&(this.update=o),i!==t&&(this.draw=i),o=i=t},this.stop=function(){o===t&&(o=this.update,this.update=e.noop),i===t&&(i=this.draw,this.draw=e.noop)},this.pause=function(){o===t&&(o=this.update,this.update=e.noop)},this.gotoFrame=function(t){e.isNumber(t)&&t>=0&&t<this.animationSequence.length&&(a=t,s=0)}}return e.SpriteSheet=n,n.prototype.createAnimation=function(n){var i;if(!n||0===Object.keys(n).length)return i=new SyntaxError("No animations found."),void e.log.error(i,"You must provide at least one named animation to create an Animation.");this.animations={};var a,s;for(var c in n)if(n.hasOwnProperty(c)){if(a=n[c],s=a.frames,a.frameSpeed=a.frameSpeed||1,a.animationSequence=[],s===t)return i=new SyntaxError("No animation frames found."),void e.log.error(i,"Animation "+c+" must provide a frames property.");if(e.isNumber(s))a.animationSequence.push(s);else if(e.isString(s))a.animationSequence=r(s);else if(e.isArray(s))for(var u,f=0;u=s[f];f++)if(e.isString(u)){var l=r(u);a.animationSequence.push.apply(a.animationSequence,l)}else a.animationSequence.push(u);this.animations[c]=new o(this,a)}},n.prototype.getAnimation=function(e){return this.animations[e]},e}(kontra||{}),kontra=function(e,t,n,r){return e.canUse=e.canUse||{},e.canUse.localStorage="localStorage"in t&&null!==t.localStorage,e.canUse.localStorage?(e.store={},e.store.set=function(e,t){t===r?this.remove(e):n.setItem(e,JSON.stringify(t))},e.store.get=function(e){var t=n.getItem(e);try{t=JSON.parse(t)}catch(r){}return t},e.store.remove=function(e){n.removeItem(e)},e.store.clear=function(){n.clear()},e):e}(kontra||{},window,window.localStorage),kontra=function(e,t){function n(e,t){this.set(e,t)}return e.Vector=n,n.prototype.set=function(e,t){this.x=e||0,this.y=t||0},n.prototype.add=function(e){this.x+=e.x,this.y+=e.y},n.prototype.length=function(){return t.sqrt(this.x*this.x+this.y*this.y)},n.prototype.angle=function(){return t.atan2(this.y,this.x)},n.fromAngle=function(e,r){return new n(r*t.cos(e),r*t.sin(e))},e}(kontra||{},Math);