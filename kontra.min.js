this.kontra={init:function(t){var e=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");this.context=e.getContext("2d")},_noop:new Function,_isString:function(t){return""+t===t},_isNumber:function(t){return+t===t},_isImage:function(t){return!!t&&"IMG"===t.nodeName||this._isCanvas(t)},_isCanvas:function(t){return!!t&&"CANVAS"===t.nodeName},_tick:new Function},function(u){var s=/(jpeg|jpg|gif|png)$/,a=/(wav|mp3|ogg|aac)$/,t=/^no$/,e=new Audio,d={wav:"",mp3:e.canPlayType("audio/mpeg;").replace(t,""),ogg:e.canPlayType('audio/ogg; codecs="vorbis"').replace(t,""),aac:e.canPlayType("audio/aac;").replace(t,"")};function f(){for(var t=[],e=0;e<arguments.length;e++)arguments[e]&&t.push(arguments[e].trim().replace(new RegExp("(^[/]{"+(t[0]?1:2)+",}|[/]*$)","g"),""));return t.join("/")}function l(t){return t.split(".").pop()}function m(t){var e=t.replace("."+l(t),"");return 0==e.indexOf("/")&&0==e.lastIndexOf("/")?e.substr(1):e}function o(i){var n=m(i),r=new Image,t=kontra.assets,s=t.images;return i=f(t.imagePath,i),new u(function(t,e){r.onload=function(){s[n]=s[i]=this,t(this)},r.onerror=function(){e(i)},r.src=i})}function h(i){var n,r,s,a,o,t=kontra.assets,h=t.audio,c=t.audioPath;return Array.isArray(i)||(i=[i]),new u(function(t,e){for(o=0;n=i[o];o++)if(d[l(n)]){s=n;break}s?(r=m(s),a=new Audio,n=f(c,s),a.addEventListener("canplay",function(){h[r]=h[n]=this,t(this)}),a.onerror=function(){e(n)},a.src=n,a.load()):e("")})}function c(n){var r=m(n),s=new XMLHttpRequest,t=kontra.assets,a=t.data;return n=f(t.dataPath,n),new u(function(e,i){s.addEventListener("load",function(){var t=s.responseText;if(200!==s.status)return i(t);try{t=JSON.parse(t)}catch(t){}a[r]=a[n]=t,e(t)}),s.open("GET",n,!0),s.send()})}kontra.assets={images:{},audio:{},data:{},imagePath:"",audioPath:"",dataPath:"",load:function(){var t,e,i,n,r=[];for(i=0;e=arguments[i];i++)n=(t=l(Array.isArray(e)?e[0]:e)).match(s)?o(e):t.match(a)?h(e):c(e),r.push(n);return u.all(r)},_canUse:d}}(Promise),function(f,l,m){f.gameLoop=function(t){var e,i,n,r,s=(t=t||{}).fps||60,a=0,o=1e3/s,h=1/s,c=!1===t.clearCanvas?f._noop:function(){f.context.clearRect(0,0,f.canvas.width,f.canvas.height)};function u(){if(i=l(u),n=m.now(),r=n-e,e=n,!(1e3<r)){for(f._tick(),a+=r;o<=a;)d.update(h),a-=o;c(),d.render()}}var d={update:t.update,render:t.render,isStopped:!0,start:function(){e=m.now(),this.isStopped=!1,l(u)},stop:function(){this.isStopped=!0,cancelAnimationFrame(i)},_frame:u,set _last(t){e=t}};return d}}(kontra,requestAnimationFrame,performance),function(){for(var r={},i={},n={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"leftwindow",92:"rightwindow",93:"select",144:"numlock",145:"scrolllock",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},t=0;t<26;t++)n[65+t]=(10+t).toString(36);for(t=0;t<10;t++)n[48+t]=""+t,n[96+t]="numpad"+t;for(t=1;t<20;t++)n[111+t]="f"+t;var e=window.addEventListener;e("keydown",function(t){var e=n[t.which];i[e]=!0,r[e]&&r[e](t)}),e("keyup",function(t){var e=n[t.which];i[e]=!1}),e("blur",function(t){i={}}),kontra.keys={bind:function(t,e){t=Array.isArray(t)?t:[t];for(var i,n=0;i=t[n];n++)r[i]=e},unbind:function(t){t=Array.isArray(t)?t:[t];for(var e,i=0;e=t[i];i++)r[e]=null},pressed:function(t){return!!i[t]}}}(),function(s,t){var i,n,r,a,o=[],h=[],c={},u=[],d={},f={0:"left",1:"middle",2:"right"};function l(){for(var t,e,i,n=h.length?h:o,r=n.length-1;0<=r;r--){var s,a=n[r];if(a.collidesWithPointer?s=a.collidesWithPointer(g):(t=a,void 0,e=g.x-Math.max(t.x,Math.min(g.x,t.x+t.width)),i=g.y-Math.max(t.y,Math.min(g.y,t.y+t.height)),s=e*e+i*i<g.radius*g.radius),s)return a}}function e(t){var e=f[t.button];d[e]=!0,p(t,"onDown")}function m(t){var e=f[t.button];d[e]=!1,p(t,"onUp")}function p(t,e){var i,n,r;s.canvas&&(-1!==t.type.indexOf("mouse")?(i=t.clientX,n=t.clientY):(i=(t.touches[0]||t.changedTouches[0]).clientX,n=(t.touches[0]||t.changedTouches[0]).clientY),g.x=i-s.canvas.offsetLeft,g.y=n-s.canvas.offsetTop,t.target===s.canvas&&(r=l())&&r[e]&&r[e](),c[e]&&c[e](t,r))}t("mousedown",e),t("touchstart",e),t("mouseup",m),t("touchend",m),t("blur",function(t){d={}}),t("mousemove",(i=function(t){p(t,"onOver")},n=32,function(){var t=this,e=arguments;a?(clearTimeout(r),r=setTimeout(function(){Date.now()-a>=n&&(i.apply(t,e),a=Date.now())},n-(Date.now()-a))):(i.apply(t,e),a=Date.now())}));var g=s.pointer={x:0,y:0,radius:5,track:function(t){t=Array.isArray(t)?t:[t];for(var e,i=0;e=t[i];i++)e._render||(e._render=e.render,e.render=function(){o.push(this),this._render&&this._render()}),-1===u.indexOf(e)&&u.push(e)},untrack:function(t){t=Array.isArray(t)?t:[t];for(var e,i=0;e=t[i];i++){e.render=e._render,e._render=null;var n=u.indexOf(e);if(-1!==n){for(var r=n;r<=u.length-2;r++)u[r]=u[r+1];u.length--}}},over:function(t){return-1!==u.indexOf(t)&&l()===t},onDown:function(t){c.onDown=t},onUp:function(t){c.onUp=t},pressed:function(t){return!!d[t]}};s._tick=function(){h.length=0,o.forEach(function(t){h.push(t)}),o.length=0}}(kontra,window.addEventListener),kontra.pool=function(t){var s=0,a=0;return{create:(t=t||{}).create,objects:[void 0],size:1,maxSize:t.maxSize||1/0,get:function(t){if(t=t||{},this.objects[0].isAlive()){if(this.size===this.maxSize)return;for(var e=0;e<this.size&&this.objects.length<this.maxSize;e++)this.objects.unshift(this.create());this.size=this.objects.length,s=this.size-1}var i=this.objects[0];i.init(t);for(var n=1;n<this.size;n++)this.objects[n-1]=this.objects[n];this.objects[s]=i,a++},getAliveObjects:function(){return this.objects.slice(this.objects.length-a)},clear:function(){a=s=this.objects.length=0,this.size=1,this.objects.push(this.create())},update:function(t){for(var e,i=s,n=Math.max(this.objects.length-a,0);n<=i;)if((e=this.objects[i]).update(t),e.isAlive())i--;else{for(var r=i;0<r;r--)this.objects[r]=this.objects[r-1];this.objects[0]=e,a--,n++}},render:function(){for(var t=Math.max(this.objects.length-a,0),e=s;t<=e;e--)this.objects[e].render&&this.objects[e].render()}}},function(n){n.quadtree=function(t){var e=Object.create(n.quadtree.prototype);return e._init(t),e},n.quadtree.prototype={_init:function(t){t=t||{},this.maxDepth=t.maxDepth||3,this.maxObjects=t.maxObjects||25,this._branch=!1,this._depth=t.depth||0,this._parent=t.parent,this.bounds=t.bounds||{x:0,y:0,width:n.canvas.width,height:n.canvas.height},this.objects=[],this.subnodes=[]},clear:function(){if(this._branch)for(var t=0;t<4;t++)this.subnodes[t].clear();this._branch=!1,this.objects.length=0},get:function(t){for(var e,i,n=[];this.subnodes.length&&this._branch;){for(e=this._getIndex(t),i=0;i<e.length;i++)n.push.apply(n,this.subnodes[e[i]].get(t));return n}return this.objects},add:function(){var t,e,i,n;for(e=0;e<arguments.length;e++)if(i=arguments[e],Array.isArray(i))this.add.apply(this,i);else if(this.subnodes.length&&this._branch)this._add2Sub(i);else if(this.objects.push(i),this.objects.length>this.maxObjects&&this._depth<this.maxDepth){for(this._split(),t=0;n=this.objects[t];t++)this._add2Sub(n);this.objects.length=0}},_add2Sub:function(t){var e,i=this._getIndex(t);for(e=0;e<i.length;e++)this.subnodes[i[e]].add(t)},_getIndex:function(t){var e=[],i=this.bounds.x+this.bounds.width/2,n=this.bounds.y+this.bounds.height/2,r=t.y<n&&t.y+t.height>=this.bounds.y,s=t.y+t.height>=n&&t.y<this.bounds.y+this.bounds.height;return t.x<i&&t.x+t.width>=this.bounds.x&&(r&&e.push(0),s&&e.push(2)),t.x+t.width>=i&&t.x<this.bounds.x+this.bounds.width&&(r&&e.push(1),s&&e.push(3)),e},_split:function(){if(this._branch=!0,!this.subnodes.length)for(var t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this.subnodes[i]=n.quadtree({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(2<=i?e:0),width:t,height:e},depth:this._depth+1,maxDepth:this.maxDepth,maxObjects:this.maxObjects,parent:this})}}}(kontra),function(o,e,r,s){o.vector=function(t,e){var i=Object.create(o.vector.prototype);return i._init(t,e),i},o.vector.prototype={_init:function(t,e){this._x=t||0,this._y=e||0},add:function(t,e){this._x+=(t.x||0)*(e||1),this._y+=(t.y||0)*(e||1)},clamp:function(t,e,i,n){this._clamp=!0,this._xMin=t!==s?t:-r,this._yMin=e!==s?e:-r,this._xMax=i!==s?i:r,this._yMax=n!==s?n:r},get x(){return this._x},get y(){return this._y},set x(t){this._x=this._clamp?e.min(e.max(this._xMin,t),this._xMax):t},set y(t){this._y=this._clamp?e.min(e.max(this._yMin,t),this._yMax):t}},o.sprite=function(t){var e=Object.create(o.sprite.prototype);return e.init(t),e},o.sprite.prototype={init:function(t){var e,i,n,r=this;for(var s in t=t||{},r.position=r.position||o.vector(),r.velocity=r.velocity||o.vector(),r.acceleration=r.acceleration||o.vector(),r.position._init(t.x,t.y),r.velocity._init(t.dx,t.dy),r.acceleration._init(t.ddx,t.ddy),r.width=r.height=0,t)r[s]=t[s];if(r.ttl=t.ttl||0,r.context=t.context||o.context,r.advance=r._advance,r.draw=r._draw,o._isImage(e=t.image))r.image=e,r.width=e.width,r.height=e.height,r.draw=r._drawImg;else if(e=t.animations){for(var a in r.animations={},e)i=e[a],r.animations[a]=i.clone?i.clone():i,n||(n=r.animations[a]);r.currentAnimation=n,r.width=n.width,r.height=n.height,r.advance=r._advanceAnim,r.draw=r._drawAnim}},get x(){return this.position.x},get y(){return this.position.y},get dx(){return this.velocity.x},get dy(){return this.velocity.y},get ddx(){return this.acceleration.x},get ddy(){return this.acceleration.y},set x(t){this.position.x=t},set y(t){this.position.y=t},set dx(t){this.velocity.x=t},set dy(t){this.velocity.y=t},set ddx(t){this.acceleration.x=t},set ddy(t){this.acceleration.y=t},isAlive:function(){return 0<this.ttl},collidesWith:function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y},update:function(t){this.advance(t)},render:function(){this.draw()},playAnimation:function(t,e){this.currentAnimation=this.animations[t],this.currentAnimation.loop=e==s||e,this.currentAnimation._frame=0},_advance:function(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.ttl--},_advanceAnim:function(t){this._advance(t),this.currentAnimation.update(t)},_draw:function(){this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height)},_drawImg:function(){this.context.drawImage(this.image,this.x,this.y)},_drawAnim:function(){this.currentAnimation.render({context:this.context,x:this.x,y:this.y})}}}(kontra,Math,1/0),function(h,t){h.animation=function(t){var e=Object.create(h.animation.prototype);return e._init(t),e},h.animation.prototype={_init:function(t){t=t||{},this.spriteSheet=t.spriteSheet,this.frames=t.frames,this.frameRate=t.frameRate,this.loop=null==t.loop||t.loop;var e=t.spriteSheet.frame;this.width=e.width,this.height=e.height,this.margin=e.margin||0,this._frame=0,this._accum=0},clone:function(){return h.animation(this)},update:function(t){if(this.loop||this._frame!=this.frames.length-1)for(t=t||1/60,this._accum+=t;1<=this._accum*this.frameRate;)this._frame=++this._frame%this.frames.length,this._accum-=1/this.frameRate},render:function(t){var e=(t=t||{}).context||h.context,i=this.frames[this._frame]/this.spriteSheet.framesPerRow|0,n=this.frames[this._frame]%this.spriteSheet.framesPerRow|0;e.drawImage(this.spriteSheet.image,n*this.width+(2*n+1)*this.margin,i*this.height+(2*i+1)*this.margin,this.width,this.height,t.x,t.y,this.width,this.height)}},h.spriteSheet=function(t){var e=Object.create(h.spriteSheet.prototype);return e._init(t),e},h.spriteSheet.prototype={_init:function(t){t=t||{},this.animations={},this.image=t.image,this.frame={width:t.frameWidth,height:t.frameHeight,margin:t.frameMargin},this.framesPerRow=t.image.width/t.frameWidth|0,this.createAnimations(t.animations)},createAnimations:function(t){var e,i,n,r;for(var s in t){i=(e=t[s]).frames,n=e.frameRate,r=[],Array.isArray(i)||(i=[i]);for(var a,o=0;a=i[o];o++)r.push.apply(r,this._parse(a));this.animations[s]=h.animation({spriteSheet:this,frames:r,frameRate:n})}},_parse:function(t){if(h._isNumber(t))return[t];var e=[],n=t.split(".."),r=i=+n[0],s=+n[1];if(r<s)for(;i<=s;i++)e.push(i);else for(;i>=s;i--)e.push(i);return e}}}(kontra),kontra.store={set:function(t,e){void 0===e?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(e))},get:function(t){var e=localStorage.getItem(t);try{e=JSON.parse(e)}catch(t){}return e}},function(d,O,f){d.tileEngine=function(t){function x(t){var e,i;return void 0!==t.x&&void 0!==t.y?(e=I.getRow(t.y),i=I.getCol(t.x)):(e=t.row,i=t.col),e<0||i<0||b<=e||_<=i?-1:i+e*_}function w(t){for(var e,i,n=0,r=I.tilesets.length-1;n<=r;){if(e=(n+r)/2|0,t>=(i=I.tilesets[e]).firstGrid&&t<=i.lastGrid)return i;i.lastGrid<t?n=e+1:r=e-1}}var e,i,_=(t=t||{}).width,b=t.height,A=t.tileWidth||t.tilewidth||32,j=t.tileHeight||t.tileheight||32,n=_*A,r=b*j,s=t.context||d.context,S=s.canvas.width,k=s.canvas.height,a=document.createElement("canvas"),l=a.getContext("2d"),o=O.max(0,n-S),h=O.max(0,r-k),m=[],I={width:_,height:b,tileWidth:A,tileHeight:j,mapWidth:n,mapHeight:r,context:s,x:t.x||0,y:t.y||0,tilesets:[],layers:{},addTilesets:function(t){f.isArray(t)||(t=[t]),t.forEach(function(t){var e,i,n,r,s,a=t.image;if(d._isImage(a))e=a;else if(d._isString(a))for(var o=1/0;0<=o;){var h=(o=a.lastIndexOf("/",o))<0?a:a.substr(o);if(d.assets.images[h]){e=d.assets.images[h];break}o--}i=t.firstGrid,n=(e.width/A|0||1)*(e.height/j|0||1),i||(0<I.tilesets.length?(s=((r=I.tilesets[I.tilesets.length-1]).image.width/A|0)*(r.image.height/j|0),i=r.firstGrid+s):i=1),I.tilesets.push({firstGrid:i,lastGrid:i+n-1,image:e}),I.tilesets.sort(function(t,e){return t.firstGrid-e.firstGrid})})},addLayers:function(t){f.isArray(t)||(t=[t]),t.forEach(function(t){var e,i,n,r,s,a;if(t.render=void 0===t.render||t.render,f.isArray(t.data[0]))for(e=[],i=0;n=t.data[i];i++)for(r=0;r<_;r++)e.push(n[r]||0);else e=t.data;for(s in I.layers[t.name]={data:e,zIndex:t.zIndex||0,render:t.render},t.properties){a=t.properties[s];try{a=JSON.parse(a)}catch(t){}I.layers[t.name][s]=a}I.layers[t.name].render&&(m.push(t.name),m.sort(function(t,e){return I.layers[t].zIndex-I.layers[e].zIndex}))}),function(){for(var t,e,i,n,r,s,a,o,h,c,u=0;c=I.layers[m[u]];u++)for(var d=0,f=c.data.length;d<f;d++)(t=c.data[d])&&(i=(e=w(t)).image,n=d%_*A,r=(d/_|0)*j,s=(o=t-e.firstGrid)%(h=i.width/A)*A,a=(o/h|0)*j,l.drawImage(i,s,a,A,j,n,r,A,j))}()},layerCollidesWith:function(t,e){for(var i,n=I.getRow(e.y),r=I.getCol(e.x),s=I.getRow(e.y+e.height),a=I.getCol(e.x+e.width),o=n;o<=s;o++)for(var h=r;h<=a;h++)if(i=x({row:o,col:h}),I.layers[t].data[i])return!0;return!1},tileAtLayer:function(t,e){var i=x(e);if(0<=i)return I.layers[t].data[i]},render:function(){I.context.drawImage(a,I.sx,I.sy,S,k,I.x,I.y,S,k)},renderLayer:function(t){for(var e,i,n,r,s,a,o,h,c,u=I.layers[t],d=I.getRow(),f=I.getCol(),l=x({row:d,col:f}),m=f*A-I.sx,p=d*j-I.sy,g=O.min(O.ceil(S/A)+1,_),y=g*O.min(O.ceil(k/j)+1,b),v=0;v<y;)(n=u.data[l])&&(s=(r=w(n)).image,e=m+v%g*A,i=p+(v/g|0)*j,h=(a=n-r.firstGrid)%(o=s.width/A)*A,c=(a/o|0)*j,I.context.drawImage(s,h,c,A,j,e,i,A,j)),++v%g==0?l=f+ ++d*_:l++},getRow:function(t){return t=t||0,(I.sy+t)/j|0},getCol:function(t){return t=t||0,(I.sx+t)/A|0},get sx(){return e},get sy(){return i},set sx(t){e=O.min(O.max(0,t),o)},set sy(t){i=O.min(O.max(0,t),h)},_layerOrder:m};for(var c in I.sx=t.sx||0,I.sy=t.sy||0,a.width=n,a.height=r,t.properties){var u=t.properties[c];try{u=JSON.parse(u)}catch(t){}I[c]=I[c]||u}return t.tilesets&&I.addTilesets(t.tilesets),t.layers&&I.addLayers(t.layers),I}}(kontra,Math,Array);