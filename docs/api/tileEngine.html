<!DOCTYPE html>
<html>
<head>
  <title>Kontra.js â€“ Kontra.tileEngine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/0.7.22/webcomponents-lite.min.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css">
  <link rel="stylesheet" href="../styles.css">

  <link rel="import" href="../components/main-nav.html">
  <link rel="import" href="../components/code-output.html">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/components/prism-javascript.min.js"></script>
  <script src="../js/kontra.js"></script>
</head>
<body>
  <div class="content">
    <main-nav></main-nav>

    <main id="main">
      <div>
        <h1 id="tileEngine">Kontra&#8203;.tileEngine&#8203;(properties)</h1>

        <dl aria-labeledby="tileEngine">
          <dt><strong>properties</strong> <em>{object}</em></dt>
          <dd>Properties of the tile engine.</dd>
          <dt><strong>properties.width</strong> <em>{number}</em></dt>
          <dd>Width of the tile map (in number of tiles).</dd>
          <dt><strong>properties.height</strong> <em>{number}</em></dt>
          <dd>Height of the tile map (in number of tiles).</dd>
          <dt><strong>properties.tilewidth</strong> <em>{number}</em></dt>
          <dd>Width of a single tile (in pixels).</dd>
          <dt><strong>properties.tileheight</strong> <em>{number}</em></dt>
          <dd>Height of a single tile (in pixels).</dd>

          <dt class="object-prop"><strong>properties.tilesets</strong> <em>{object[]}</em></dt>
          <dd>Array of tileset objects.</dd>
          <dt><strong>properties.tilesets.firstgid</strong> <em>{number}</em></dt>
          <dd>First tile index of the tileset. The first tileset will have a firstgid> of 1 as 0 represents an empty tile.</dd>
          <dt><strong>properties.tilesets.image</strong> <em>{string | HTMLImageElement}</em></dt>
          <dd>Relative path to the HTMLImageElement or an HTMLImageElement.</dd>
          <dt><strong>properties.tilesets.margin</strong> <em>{number}</em></dt>
          <dd>Optional. The amount of whitespace between each tile. Defaults to 0.</dd>
          <dt><strong>properties.tilesets.tilewidth</strong> <em>{number}</em></dt>
          <dd>Optional. Width of the tileset (in number of tiles). Defaults to <a href="#tilewidth">tilewidth</a>.</dd>
          <dt><strong>properties.tilesets.tileheight</strong> <em>{number}</em></dt>
          <dd>Optional. Height of the tileset (in number of tiles). Defaults to <a href="#tileheight">tileheight</a>.</dd>
          <dt><strong>properties.tilesets.source</strong> <em>{string}</em></dt>
          <dd>Optional. Relative path to the tileset JSON file.</dd>
          <dt><strong>properties.tilesets.columns</strong> <em>{number}</em></dt>
          <dd>Optional. Number of columns in the tileset image.</dd>

          <dt class="object-prop"><strong>properties.layers</strong> <em>{object[]}</em></dt>
          <dd>Array of layer objects.</dd>
          <dt><strong>properties.layers.name</strong> <em>{string}</em></dt>
          <dd>Unique name of the layer.</dd>
          <dt><strong>properties.layers.data</strong> <em>{number[]}</em></dt>
          <dd>1D array of tile indices.</dd>
          <dt><strong>properties.layers.visible</strong> <em>{boolean}</em></dt>
          <dd>Optional. If the layer should be drawn or not. Defaults to true.</dd>
          <dt><strong>properties.layers.opacity</strong> <em>{number}</em></dt>
          <dd>Optional. Percent opacity of the layer. Defaults to 1.</dd>

        </dl>

        <p>A tile engine for managing and drawing tilesets.</p>

        <figure>
          <a href="../imgs/mapPack_tilesheet.png">
            <img src="../imgs/mapPack_tilesheet.png" alt="Tileset to create an overworld map in various seasons."/>
          </a>
          <figcaption>Tileset image courtesy of <a href="https://kenney.nl/assets">Kenny</a>.</figcaption>
        </figure>





        <section class="toc">
          <h2 id="toc"><a href="#toc" class="section-link">Table of Contents<span aria-hidden="true">#</span></a></h2>

          <ul aria-labeledby="toc">
            <li><a href="#basic-use">Basic Use</a></li>
            <li><a href="#advance-use">Advance Use</a></li>
            <li><a href="#camera">Moving the Camera</a></li>

            <li>
              <h3 id="properties">Properties</h3>
              <ul aria-labeledby="properties">
                <li><a href="#context">kontra.tileEngine&#8203;.context</a></li>
                <li><a href="#height">kontra.tileEngine&#8203;.height</a></li>
                <li><a href="#layers">kontra.tileEngine&#8203;.layers</a></li>
                <li><a href="#mapheight">kontra.tileEngine&#8203;.mapheight</a></li>
                <li><a href="#mapwidth">kontra.tileEngine&#8203;.mapwidth</a></li>
                <li><a href="#sx">kontra.tileEngine&#8203;.sx</a></li>
                <li><a href="#sy">kontra.tileEngine&#8203;.sy</a></li>
                <li><a href="#tileheight">kontra.tileEngine&#8203;.tileheight</a></li>
                <li><a href="#tilesets">kontra.tileEngine&#8203;.tilesets</a></li>
                <li><a href="#tilewidth">kontra.tileEngine&#8203;.tilewidth</a></li>
                <li><a href="#width">kontra.tileEngine&#8203;.width</a></li>
              </ul>
            </li>

            <li>
              <h3 id="methods">Methods</h3>
              <ul aria-labeledby="methods">
                <li><a href="#layerCollidesWith">kontra.tileEngine&#8203;.layerCollidesWith(name, object)</a></li>
                <li><a href="#render">kontra.tileEngine&#8203;.render()</a></li>
                <li><a href="#renderLayer">kontra.tileEngine&#8203;.renderLayer(name)</a></li>
                <li><a href="#tileAtLayer">kontra.tileEngine&#8203;.tileAtLayer(name, position)</a></li>
              </ul>
            </li>
          </ul>
        </section>





        <section>
          <h2 id="basic-use"><a href="#basic-use" class="section-link">Basic Use<span aria-hidden="true">#</span></a></h2>

          <p>Creating a tile map requires three things:</p>

          <ol>
            <li>Dimensions of the tile map and a tile</li>
            <li>At least one tileset with an image</li>
            <li>At least one layer with data</li>
          </ol>

          <p>To set up the tile engine, you'll need to pass it the width and height of a tile (in pixels) and the width and height of the map (in number of tiles).</p>

          <p>You'll then need to add at least one tileset with an image as well as firstgid, or fist tile index of the tileset. The first tileset will always have a firstgid of 1 as <code>0</code> represents an empty tile.</p>

          <p>Lastly, you'll need to add at least one layer. A layer will tell the tile engine which tiles from the tileset image to use at what position on the map.</p>

          <p>Once all tileset images and all layers have been added, you can render the tile engine by calling its <a href="#render">render()</a> function.</p>

<code-output width="576" height="576">
let img = document.createElement('img');
img.src = '../imgs/mapPack_tilesheet.png';

img.onload = function() {
  let tileEngine = kontra.tileEngine({
    // tile size
    tilewidth: 64,
    tileheight: 64,

    // map size in tiles
    width: 9,
    height: 9,

    tilesets: [{
      firstgid: 1,
      image: img
    }],

    layers: [{
      name: 'ground',
      data: [ 0,  0,  0,  0,  0,  0,  0,  0,  0,
              0,  0,  6,  7,  7,  8,  0,  0,  0,
              0,  6,  27, 24, 24, 25, 0,  0,  0,
              0,  23, 24, 24, 24, 26, 8,  0,  0,
              0,  23, 24, 24, 24, 24, 26, 8,  0,
              0,  23, 24, 24, 24, 24, 24, 25, 0,
              0,  40, 41, 41, 10, 24, 24, 25, 0,
              0,  0,  0,  0,  40, 41, 41, 42, 0,
              0,  0,  0,  0,  0,  0,  0,  0,  0 ]
    }]
  });

  /* exclude:start */
  tileEngine.context = context;
  /* exclude:end */
  tileEngine.render();
}
</code-output>

        </section>





        <section>
          <h2 id="advance-use"><a href="#advance-use" class="section-link">Advance Use<span aria-hidden="true">#</span></a></h2>

          <p>Adding all the tileset images and layers to a tile engine can be tedious, especially if you have multiple layers. If you want a simpler way to create a tile engine, Kontra has been written to work directly with the JSON output of the <a href="http://www.mapeditor.org/">Tiled Map Editor</a>.</p>

          <p>The one requirement is that you must preload all of the tileset images and tileset sources using <a href="assets#load">kontra.assets.load()</a> before you create the tile engine.</p>

<code-output width="576" height="576">
kontra.assets.load('../imgs/mapPack_tilesheet.png', '../data/tile_engine_basic.json')
  .then(function() {
    let tileEngine = kontra.tileEngine(kontra.assets.data['../data/tile_engine_basic']);
    /* exclude:start */
    tileEngine.context = context;
    /* exclude:end */

    tileEngine.render();
  });
</code-output>

        </section>





        <section>
          <h2 id="camera"><a href="#camera" class="section-link">Moving the Camera<span aria-hidden="true">#</span></a></h2>

          <p>If your tilemap is larger than the canvas size, you can move the tilemap camera to change how the tilemap is drawn. Use the tile engines <a href="#sx">sx</a> and <a href="#sy">sy</a> properties to move the camera. Just like drawing an image, the cameras coordinates are the top left corner.</p>

          <p>The <code>sx</code> and <code>sy</code> coordinates will never draw the tile map below 0 or beyond the last row or column of the tile map.</p>

<code-output width="576" height="576">
kontra.assets.load('../imgs/mapPack_tilesheet.png', '../data/tile_engine_camera.json')
  .then(function() {
    let tileEngine = kontra.tileEngine(kontra.assets.data['../data/tile_engine_camera']);
    /* exclude:start */
    tileEngine.context = context;
    /* exclude:end */

    let sx = 1;
    let loop = kontra.gameLoop({
      update: function() {
        tileEngine.sx += sx;

        if (tileEngine.sx <= 0 || tileEngine.sx >= 320) {
          sx = -sx;
        }
      },
      render: function() {
        tileEngine.render();
      }
    });

    loop.start();
  });
</code-output>

        </section>





        <section>
          <h2 id="context"><a href="#context" class="section-link">kontra.tileEngine&#8203;.context<span aria-hidden="true">#</span></a></h2>

          <p><em>{CanvasRenderingContext2D}</em></p>

          <p>The context the tile engine will draw to.</p>

        </section>





        <section>
          <h2 id="height"><a href="#height" class="section-link">kontra.tileEngine&#8203;.height<span aria-hidden="true">#</span></a></h2>

          <p><em>{number}</em></p>

          <p>The height of the map in tiles.</p>

        </section>





        <section>
          <h2 id="layerCollidesWith"><a href="#layerCollidesWith" class="section-link">kontra.tileEngine&#8203;.layerCollidesWith(name, object)<span aria-hidden="true">#</span></a></h2>

          <dl>
            <dt><strong>name</strong> <em>{string}</em></dt>
            <dd>The name of the layer to check for collision.</dd>
            <dt><strong>object</strong> <em>{object}</em></dt>
            <dd>The object to check collision against.</dd>
          </dl>

          <p>Check if the object collides with the layer (shares a gird coordinate with any positive tile index in layers data). The object being checked must have the properties <code>x</code>, <code>y</code>, <code>width</code>, and <code>height</code> so that its position in the grid can be calculated. <a href="sprite">kontra.sprite</a> defines these properties for you.</p>

          <pre><code class="language-javascript">let tileEngine = kontra.tileEngine({
  tilewidth: 32,
  tileheight: 32,
  width: 4,
  height: 4,
  tilesets: [{/* ... */}],
  layers: [{
    name: 'collision',
    data: [ 0,0,0,0,
            0,1,4,0,
            0,2,5,0,
            0,0,0,0 ]
  }]
});

let sprite = kontra.sprite({
  x: 50,
  y: 20,
  width: 5,
  height: 5
});

tileEngine.layerCollidesWith('collision', sprite);  //=> false

sprite.y = 28;

tileEngine.layerCollidesWith('collision', sprite);  //=> true</code></pre>

        </section>





        <section>
          <h2 id="layers"><a href="#layers" class="section-link">kontra.tileEngine&#8203;.layers<span aria-hidden="true">#</span></a></h2>

          <p><em>{object[]}</em></p>

          <p>Array of all layers of the tile engine.</p>

        </section>





        <section>
          <h2 id="mapheight"><a href="#mapheight" class="section-link">kontra.tileEngine&#8203;.mapheight<span aria-hidden="true">#</span></a></h2>

          <p><em>{number}</em></p>

          <p>The height of a tile map in pixels.</p>

        </section>





        <section>
          <h2 id="mapwidth"><a href="#mapwidth" class="section-link">kontra.tileEngine&#8203;.mapwidth<span aria-hidden="true">#</span></a></h2>

          <p><em>{number}</em></p>

          <p>The width of a tile map in pixels.</p>

        </section>





        <section>
          <h2 id="render"><a href="#render" class="section-link">kontra.tileEngine&#8203;.render()<span aria-hidden="true">#</span></a></h2>

          <p>Render all visible layers.</p>

        </section>





        <section>
          <h2 id="renderLayer"><a href="#renderLayer" class="section-link">kontra.tileEngine&#8203;.renderLayer(name)<span aria-hidden="true">#</span></a></h2>

          <dl>
            <dt><strong>name</strong> <em>{string}</em></dt>
            <dd>Name of the layer.</dd>
          </dl>

          <p>Render a specific layer.</p>

        </section>





        <section>
          <h2 id="sx"><a href="#sx" class="section-link">kontra.tileEngine&#8203;.sx<span aria-hidden="true">#</span></a></h2>

          <p><em>{number}</em></p>

          <p>X coordinate of the tile map camera.</p>

        </section>





        <section>
          <h2 id="sy"><a href="#sy" class="section-link">kontra.tileEngine&#8203;.sy<span aria-hidden="true">#</span></a></h2>

          <p><em>{number}</em></p>

          <p>Y coordinate of the tile map camera.</p>

        </section>





        <section>
          <h2 id="tileAtLayer"><a href="#tileAtLayer" class="section-link">kontra.tileEngine&#8203;.tileAtLayer(name, position)<span aria-hidden="true">#</span></a></h2>

          <dl>
            <dt><strong>name</strong> <em>{string}</em></dt>
            <dd>Name of the layer.</dd>
            <dt><strong>position</strong> <em>{object}</em></dt>
            <dd>Position of the tile using either <code>x</code> and <code>y</code> or <code>row</code> and <code>col</code>.</dd>
          </dl>

          <p>Get the tile at the specified layer using either x and y coordinates or row and column coordinates.</p>

          <pre><code class="language-javascript">let tileEngine = kontra.tileEngine({
  tilewidth: 32,
  tileheight: 32,
  width: 4,
  height: 4,
  tilesets: [{/* ... */}],
  layers: [{
    name: 'collision',
    data: [ 0,0,0,0,
            0,1,4,0,
            0,2,5,0,
            0,0,0,0 ]
  }]
});

tileEngine.tileAtLayer('collision', {x: 50, y: 50});  //=> 1
tileEngine.tileAtLayer('collision', {row: 2, col: 1});  //=> 2</code></pre>

        </section>





        <section>
          <h2 id="tileheight"><a href="#tileheight" class="section-link">kontra.tileEngine&#8203;.tileheight<span aria-hidden="true">#</span></a></h2>

          <p><em>{number}</em></p>

          <p>The height of a tile.</p>

        </section>





        <section>
          <h2 id="tilesets"><a href="#tilesets" class="section-link">kontra.tileEngine&#8203;.tilesets<span aria-hidden="true">#</span></a></h2>

          <p><em>{object[]}</em></p>

          <p>Array of all tilesets of the tile engine.</p>

        </section>





        <section>
          <h2 id="tilewidth"><a href="#tilewidth" class="section-link">kontra.tileEngine&#8203;.tilewidth<span aria-hidden="true">#</span></a></h2>

          <p><em>{number}</em></p>

          <p>The width of a tile.</p>

        </section>





        <section>
          <h2 id="width"><a href="#width" class="section-link">kontra.tileEngine&#8203;.width<span aria-hidden="true">#</span></a></h2>

          <p><em>{number}</em></p>

          <p>The width of the map in tiles.</p>

        </section>
       </div>
    </main>
  </div>

</body>
</html>
