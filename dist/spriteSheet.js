!function(m,t){m.animation=function(t){var i=Object.create(m.animation.prototype);return i._init(t),i},m.animation.prototype={_init:function(t){t=t||{},this.spriteSheet=t.spriteSheet,this.frames=t.frames,this.frameRate=t.frameRate,this.loop=null==t.loop||t.loop;var i=t.spriteSheet.frame;this.width=i.width,this.height=i.height,this.margin=i.margin||0,this._frame=0,this._accum=0},clone:function(){return m.animation(this)},reset:function(){this._frame=0,this._accum=0},update:function(t){if(this.loop||this._frame!=this.frames.length-1)for(t=t||1/60,this._accum+=t;1<=this._accum*this.frameRate;)this._frame=++this._frame%this.frames.length,this._accum-=1/this.frameRate},render:function(t){var i=(t=t||{}).context||m.context,e=this.frames[this._frame]/this.spriteSheet.framesPerRow|0,r=this.frames[this._frame]%this.spriteSheet.framesPerRow|0;i.drawImage(this.spriteSheet.image,r*this.width+(2*r+1)*this.margin,e*this.height+(2*e+1)*this.margin,this.width,this.height,t.x,t.y,this.width,this.height)}},m.spriteSheet=function(t){var i=Object.create(m.spriteSheet.prototype);return i._init(t),i},m.spriteSheet.prototype={_init:function(t){t=t||{},this.animations={},this.image=t.image,this.frame={width:t.frameWidth,height:t.frameHeight,margin:t.frameMargin},this.framesPerRow=t.image.width/t.frameWidth|0,this.createAnimations(t.animations)},createAnimations:function(t){var i,e,r,a;for(var h in t){e=(i=t[h]).frames,r=i.frameRate,a=[],Array.isArray(e)||(e=[e]);for(var s,n=0;s=e[n];n++)a.push.apply(a,this._parse(s));this.animations[h]=m.animation({spriteSheet:this,frames:a,frameRate:r,loop:i.loop})}},_parse:function(t){if(m._isNumber(t))return[t];var e=[],r=t.split(".."),a=i=+r[0],h=+r[1];if(a<h)for(;i<=h;i++)e.push(i);else for(;i>=h;i--)e.push(i);return e}}}(kontra);